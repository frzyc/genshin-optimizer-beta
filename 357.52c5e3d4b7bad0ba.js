"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[357],{50357:(e,t,n)=>{n.r(t),n.d(t,{default:()=>nr});var a=n(96e3),i=n(85439),l=n(36380),r=n(61391),s=n(60319),c=n(68826),o=n(32782),d=n(67550),u=n(79906),Z=n(7671),h=n(38484),p=n(78287),m=n(83249),f=n(2784),g=n(21548),x=n(73557),y=n(39857),b=n(87985),v=n(67937),C=n(72055),w=n(69360),B=n(97859),k=n(83673),S=n(53710),X=n(790),P=n(63762);const K=(0,f.createContext)({});var O=n(13913),E=n(25870),j=n(94657),D=n(44304),I=n(50670),A=n(10002),R=n(25434),G=n(44942),M=n(47165),T=n(36893),_=n(25638),V=n(56748),N=n(97856),z=n(52903);const L=f.lazy((()=>Promise.all([n.e(592),n.e(26)]).then(n.bind(n,1296))));function q(){var e;const{t}=(0,g.$G)("page_character"),{characterSheet:n}=(0,f.useContext)(S.K),[a,i]=(0,f.useState)(!1),l=(0,N.Z)();return(0,z.BX)(z.HY,{children:[(0,z.tZ)(f.Suspense,{fallback:!1,children:(0,z.tZ)(L,{show:a,onHide:()=>i(!1),onSelect:l})}),(0,z.tZ)(m.Z,{color:"info",onClick:()=>i(!0),startIcon:(0,z.tZ)(V.Z,{src:null==n?void 0:n.thumbImgSide}),children:null!=(e=null==n?void 0:n.name)?e:t("selectCharacter")})]})}var $=n(84485),W=n(42523),F=n(56961),H=n(23570),U=n(2995),Y=n(62197),J=n(35322),Q=n(17447),ee=n(86113),te=n(2344),ne=n(26578),ae=n(98927),ie=n(99625),le=n(61278);function re(){const{modalOpen:e}=(0,f.useContext)(P.M),{setFormulaData:t}=(0,f.useContext)(P.M),n=(0,f.useCallback)((()=>null==t?void 0:t(void 0,void 0)),[t]);return(0,z.tZ)(ae.Z,{open:!!e,onClose:n,children:(0,z.BX)(b.Z,{children:[(0,z.tZ)(W.Z,{title:"Formulas & Calculations",action:(0,z.tZ)(C.Z,{onClick:n})}),(0,z.tZ)(Z.Z,{sx:{pt:0},children:(0,z.tZ)(se,{})})]})})}function se(){const{data:e}=(0,f.useContext)(X.R),{data:t}=(0,f.useContext)(P.M),n=(0,ie.U)(null!=t?t:e);return(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:1e3}),children:(0,z.tZ)(d.Z,{sx:{mr:-1,mb:-1},children:n.map((([e,t])=>(0,z.tZ)(ce,{displayNs:t,sectionKey:e},e)))})})}function ce({sectionKey:e,displayNs:t}){const{data:n}=(0,f.useContext)(X.R),{database:a}=(0,f.useContext)(E.t),{data:i}=(0,f.useContext)(P.M),l=(0,R.Z)((()=>(0,ie.f)(null!=i?i:n,e,a)),[i,n,e]);if(!l)return null;if(Object.entries(t).every((([e,t])=>t.isEmpty)))return null;const{title:r,icon:s,action:c}=l;return(0,z.BX)(v.Z,{sx:{mb:1},children:[(0,z.tZ)(ee.Z,{avatar:s&&(0,z.tZ)(ne.Z,{size:2,sx:{m:-1},src:s}),title:r,action:c&&(0,z.tZ)(k.Z,{children:c})}),(0,z.tZ)(F.Z,{}),(0,z.tZ)(Z.Z,{children:Object.entries(t).map((([e,t])=>!t.isEmpty&&(0,z.tZ)(oe,{node:t},e)))})]})}function oe({node:e}){const{node:t}=(0,f.useContext)(P.M),[n,a]=(0,f.useState)(!1),i=(0,f.useCallback)(((e,t)=>a(t)),[]),l=(0,f.useRef)();return(0,f.useEffect)((()=>{e===t&&setTimeout((()=>{var e;return null==l||null==(e=l.current)||null==e.scrollIntoView?void 0:e.scrollIntoView({behavior:"smooth"})}),300)}),[l,e,t]),(0,z.BX)(H.Z,{sx:{bgcolor:"contentDark.main"},expanded:e===t||n,onChange:i,ref:l,children:[(0,z.BX)(U.Z,{expandIcon:(0,z.tZ)($.Z,{}),children:[(0,z.BX)(Y.Z,{children:[(0,z.tZ)(te.Z,{color:e.info.variant,children:e.info.name})," ",(0,z.tZ)("strong",{children:(0,le.p)(e)})]}),T.jU.includes(e.info.variant)&&(0,z.tZ)(d.Z,{sx:{display:"inline-block",ml:"auto",mr:2},children:(0,z.tZ)(Q.Z,{reaction:e.info.variant,trigger:e.info.subVariant})})]}),(0,z.tZ)(J.Z,{children:e.formulas.map(((e,t)=>(0,z.tZ)(Y.Z,{component:"div",children:e},t)))})]})}var de=n(33927),ue=n(41075),Ze=n(15873),he=n(32510),pe=n(5658),me=n(27216),fe=n(66198),ge=n(41033),xe=n(34958),ye=n(19807),be=n(31461),ve=n(65992),Ce=n(85801);const we=["expand"],Be=(0,ve.ZP)((e=>{const t=(0,be.Z)(e,we);return(0,z.tZ)(Ce.Z,Object.assign({},t))}))((({theme:e,expand:t})=>({transform:t?"rotate(180deg)":"rotate(0deg)",marginLeft:"auto",transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})})));var ke=n(52972),Se=n(38553),Xe=n(89343),Pe=n(87051);const Ke=["name","children","value","placeholder","defaultValue","onValueChange","percent","disabled","onReset"],Oe=(0,ve.ZP)(Se.Z)({display:"flex"});function Ee(e){let{name:t,children:n,value:a,placeholder:i,defaultValue:l=0,onValueChange:r,percent:s=!1,disabled:c=!1,onReset:o}=e,d=(0,be.Z)(e,Ke);return(0,z.BX)(Oe,Object.assign({},d,{children:[n,(0,z.tZ)(Pe.Z,{sx:{px:1},children:t}),(0,z.tZ)(Xe.CC,{sx:{flexBasis:"10em",flexGrow:1},children:(0,z.tZ)(Xe.ZP,{sx:{px:1},inputProps:{sx:{textAlign:"right"}},float:s,placeholder:i,value:a,onChange:r,disabled:c,endAdornment:s?"%":void 0})}),(0,z.tZ)(m.Z,{sx:{flexShrink:2},size:"small",color:"error",onClick:()=>o?o():r(l),disabled:c||a===l,children:(0,z.tZ)(he.Z,{})})]}))}let je,De=e=>e;function Ie(){const{t:e}=(0,g.$G)("ui"),{characterDispatch:t}=(0,f.useContext)(S.K),{data:n}=(0,f.useContext)(X.R),[a,i]=(0,f.useState)(!1),l=(0,f.useCallback)((()=>i(!a)),[i,a]),r=n.get(xe.ri.enemy.level),s=n.get(xe.ri.enemy.defRed),c=n.get(xe.ri.enemy.defIgn),o=(0,f.useCallback)((()=>t({enemyOverride:{}})),[t]);return(0,z.BX)(v.Z,{children:[(0,z.BX)(Z.Z,{sx:{display:"flex",gap:1,alignItems:"center",flexWrap:"wrap"},children:[(0,z.tZ)(fe.Z,{size:"small",color:"success",label:(0,z.BX)("span",{children:[r.info.name," ",(0,z.tZ)("strong",{children:r.value})]})}),T.Kj.map((e=>(0,z.tZ)(Y.Z,{children:(0,z.tZ)(Ae,{element:e})},e))),(0,z.BX)(Y.Z,{children:["DEF Red. ",(0,le.p)(s)]}),(0,z.BX)(Y.Z,{children:["DEF Ignore ",(0,le.p)(c)]}),(0,z.BX)(d.Z,{flexGrow:1,display:"flex",justifyContent:"flex-end",gap:1,children:[(0,z.tZ)(m.Z,{size:"small",color:"error",onClick:o,startIcon:(0,z.tZ)(he.Z,{}),children:e(je||(je=De`reset`))}),(0,z.tZ)(Be,{expand:a,onClick:l,"aria-expanded":a,"aria-label":"show more",size:"small",sx:{marginLeft:0},children:(0,z.tZ)($.Z,{})})]})]}),(0,z.tZ)(ge.Z,{in:a,timeout:"auto",unmountOnExit:!0,children:(0,z.tZ)(Z.Z,{sx:{pt:0},children:(0,z.tZ)(Re,{})})})]})}function Ae({element:e}){const{data:t}=(0,f.useContext)(X.R),n=t.get(xe.ri.enemy[`${e}_res_`]),a=!isFinite(n.value)?(0,z.BX)("span",{children:[ke.Z[e]," \u221e"]}):(0,z.BX)("span",{children:[ke.Z[e]," ",(0,z.tZ)("strong",{children:(0,le.p)(n)})]});return(0,z.tZ)(te.Z,{color:e,children:a})}function Re({bsProps:e={xs:12,md:6}}){var t,n,a;const{character:{enemyOverride:i},characterDispatch:l}=(0,f.useContext)(S.K),{data:r}=(0,f.useContext)(X.R),s=null!=(t=i.enemyLevel)?t:r.get(xe.ri.lvl).value,c=null!=(n=i.enemyDefIgn_)?n:0,o=null!=(a=i.enemyDefRed_)?a:0;return(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(m.Z,{fullWidth:!0,sx:{height:"100%"},size:"small",component:"a",color:"warning",href:"https://genshin-impact.fandom.com/wiki/Resistance#Base_Enemy_Resistances",target:"_blank",rel:"noreferrer",children:"To get the specific resistance values of enemies, please visit the wiki."})})),(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(Ee,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,z.tZ)("b",{children:ye.ZP.get("enemyLevel")}),value:s,placeholder:ye.ZP.getStr("enemyLevel"),defaultValue:r.get(xe.ri.lvl).value,onValueChange:e=>l({type:"enemyOverride",statKey:"enemyLevel",value:e}),onReset:()=>l({type:"enemyOverride",statKey:"enemyLevel",value:void 0})})})),T.Kj.map((t=>{const n=`${t}_enemyRes_`,a=i[n],r=a===Number.MAX_VALUE;return(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(Ee,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,z.tZ)(te.Z,{color:t,children:(0,z.tZ)("b",{children:ye.ZP.get(n)})}),value:void 0!==a?r?1/0:a:10,placeholder:r?"\u221e ":ye.ZP.getStr(n),defaultValue:10,onValueChange:e=>l({type:"enemyOverride",statKey:n,value:e}),disabled:r,percent:!0,children:(0,z.tZ)(m.Z,{color:t,onClick:()=>l({type:"enemyOverride",statKey:n,value:r?10:Number.MAX_VALUE}),startIcon:r?(0,z.tZ)(pe.Z,{}):(0,z.tZ)(me.Z,{}),children:"Immunity"})})}),t)})),(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(Ee,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,z.tZ)("b",{children:ye.ZP.get("enemyDefIgn_")}),value:c,placeholder:ye.ZP.getStr("enemyDefIgn_"),defaultValue:0,onValueChange:e=>l({type:"enemyOverride",statKey:"enemyDefIgn_",value:e}),percent:!0})})),(0,z.tZ)(ue.ZP,Object.assign({item:!0},e,{children:(0,z.tZ)(Ee,{sx:{bgcolor:e=>e.palette.contentLight.main,width:"100%"},name:(0,z.tZ)("b",{children:ye.ZP.get("enemyDefRed_")}),value:o,placeholder:ye.ZP.getStr("enemyDefRed_"),defaultValue:0,onValueChange:e=>l({type:"enemyOverride",statKey:"enemyDefRed_",value:e}),percent:!0})})),(0,z.tZ)(ue.ZP,{item:!0,xs:12,children:(0,z.tZ)("small",{children:"Note: Genshin Impact halves resistance shred values below 0%. For the sake of calculations enter the RAW value and GO will do the rest. (e.g. 10% - 20% = -10%)"})})]})}var Ge=n(64919),Me=n(86953);let Te,_e=e=>e;const Ve={xs:1,md:2,lg:3};function Ne({open:e,onClose:t}){const{t:n}=(0,g.$G)("page_character");return(0,z.tZ)(ae.Z,{open:e,onClose:t,children:(0,z.BX)(b.Z,{children:[(0,z.tZ)(W.Z,{title:n(Te||(Te=_e`addStats.title`)),action:(0,z.tZ)(C.Z,{onClick:t})}),(0,z.tZ)(Z.Z,{sx:{pt:0},children:(0,z.BX)(de.Z,{spacing:1,children:[(0,z.tZ)(qe,{}),(0,z.tZ)(Ie,{}),(0,z.tZ)(Je,{})]})})]})})}const ze=[...xe.lR],Le=(e,t)=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:e},t);function qe(){const{character:{bonusStats:e},characterDispatch:t}=(0,f.useContext)(S.K),n=(0,f.useCallback)((e=>t({bonusStats:e})),[t]);return(0,z.tZ)(v.Z,{children:(0,z.tZ)(Z.Z,{sx:{display:"flex"},children:(0,z.tZ)(ue.ZP,{container:!0,columns:Ve,sx:{pt:1},spacing:1,children:(0,z.tZ)(Me.Z,{statKeys:ze,statFilters:e,setStatFilters:n,wrapperFunc:Le})})})})}const $e=["eleMas","critRate_","critDMG_","enerRech_","heal_"],We=["hp","atk","def",...$e].map((e=>xe.ri.total[e])),Fe=["atk_","atk","hp_","hp","def_","def",...$e],He=[...ye.hX,...ye.Sx,"stamina","incHeal_","shield_","cdRed_"],Ue=xe.lR.filter((e=>!Fe.includes(e)&&!He.includes(e)));function Ye({nodes:e,extra:t}){const{data:n,oldData:a}=(0,f.useContext)(X.R);return(0,z.BX)(Ge.lD,{children:[e.map((e=>{var t;return(0,z.tZ)(Ge.JW,{component:Ze.ZP,node:n.get(e),oldValue:null==a||null==(t=a.get(e))?void 0:t.value},JSON.stringify(e.info))})),t]})}function Je(){const{characterSheet:e}=(0,f.useContext)(S.K),{data:t}=(0,f.useContext)(X.R),n=t.get(xe.ri.special),a=e.elementKey,i=e.isMelee(),l=(0,f.useMemo)((()=>He.filter((e=>!e.includes(a)&&(i&&e.includes("physical"),!0))).map((e=>xe.ri.total[e])).filter((e=>!!t.get(e).value))),[t,a,i]),r=(0,f.useMemo)((()=>Ue.map((e=>xe.ri.total[e])).filter((e=>t.get(e).value))),[t]);return(0,z.tZ)(v.Z,{children:(0,z.tZ)(Z.Z,{children:(0,z.BX)(ue.ZP,{container:!0,columns:Ve,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Qe,{title:"Main Stats",children:(0,z.tZ)(Ye,{nodes:We,extra:n&&(0,z.BX)(Ze.ZP,{sx:{display:"flex",justifyContent:"space-between"},children:[(0,z.BX)("span",{children:[(0,z.tZ)("b",{children:"Special:"})," ",(0,z.BX)(te.Z,{color:n.info.variant,children:[n.info.icon," ",n.info.name]})]}),(0,z.tZ)("span",{children:(0,le.p)(n)})]})})})}),(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Qe,{title:"Other Stats",children:(0,z.tZ)(Ye,{nodes:l})})}),!!r.length&&(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Qe,{title:"Misc Stats",children:(0,z.tZ)(Ye,{nodes:r})})})]})})})}function Qe({title:e,children:t}){return(0,z.BX)(b.Z,{children:[(0,z.tZ)(Z.Z,{sx:{py:1},children:(0,z.tZ)(d.Z,{display:"flex",justifyContent:"space-between",children:(0,z.tZ)(Y.Z,{variant:"subtitle1",children:e})})}),t]})}var et=n(36269),tt=n(46342),nt=n(107),at=n(23119),it=n(94380),lt=n(92794),rt=n(32912),st=n(7300),ct=n(50875),ot=n(45475),dt=n(29432);const ut=(0,f.createContext)(void 0);var Zt=n(65469),ht=n(30507),pt=n(30597),mt=n(36617),ft=n(82716),gt=n(41015),xt=n(60791),yt=n(40580),bt=n(97797);function vt(e,t,n=!1){const a=new Set,i=new Set;function l(e,t){t?a.add(e):e.operands.forEach((e=>a.has(e)&&i.add(e)))}const r=new Set;if((0,yt.aD)(e,(e=>{}),(e=>{const{operation:t}=e;switch(t){case"read":r.add(e.path[1]),l(e,!0);break;case"add":l(e,e.operands.every((e=>a.has(e))));break;case"mul":{const t=e.operands.filter((e=>"const"!==e.operation));l(e,0===t.length||1===t.length&&a.has(t[0]));break}case"const":l(e,!0);break;case"res":case"threshold":case"sum_frac":case"max":case"min":l(e,!1);break;default:(0,gt.UT)(t)}})),[...i].every((({operation:e})=>"read"===e||"const"===e))&&Object.keys(t.base).length===r.size)return{nodes:e,arts:t};let s=-1;function c(){for(;r.has(""+ ++s););return`${s}`}e.forEach((e=>a.has(e)&&i.add(e)));const o=[...i].filter((e=>"const"!==e.operation)),d=new Map(o.map((e=>[e,n||"read"!==e.operation||"dyn"!==e.path[0]?Object.assign({},(0,bt.UF)(["dyn",`${c()}`]),{accu:"add"}):e])));function u(e){const t=(0,pt.CG)([...d.keys()],{dyn:(0,gt.xh)(e,(e=>(0,bt.a9)(e)))},(e=>!0));return Object.fromEntries([...d.values()].map(((e,n)=>[e.path[1],t[n].value])))}const Z={nodes:e=(0,yt.uW)(e,(e=>{var t;return null!=(t=d.get(e))?t:e}),(e=>e)),arts:{base:u(t.base),values:(0,gt.O)(T.eV,(e=>t.values[e].map((({id:e,set:t,values:n})=>({id:e,set:t,values:u(n)})))))}},h=Object.entries(u({}));for(const p of Object.values(Z.arts.values))for(const{values:e}of p)for(const[t,n]of h)e[t]-=n;return Z}function Ct(e,t,n){var a;let i=!1;const l=!(null!=(a=n.rainbow)&&a.length),r=Object.keys(e.base),s=new Set(Object.entries(n).filter((([e,t])=>t.length)).map((([e])=>e))),c=new Set(Object.entries(n).filter((([e,t])=>t.includes(2)&&!t.includes(4))).map((([e])=>e))),o=(0,gt.O)(T.eV,(n=>{const a=e.values[n],o=a.filter((e=>{let n=0;return a.every((a=>{const i=r.every((t=>{var n,i;return(null!=(n=a.values[t])?n:0)>=(null!=(i=e.values[t])?i:0)})),o=r.some((t=>{var n,i;return(null!=(n=a.values[t])?n:0)>(null!=(i=e.values[t])?i:0)})),d=i&&(o||a.id>e.id),u=l&&!s.has(a.set)&&!c.has(e.set)||e.set===a.set;return d&&u&&n++,n<t}))}));return o.length!==a.length&&(i=!0),o}));return i?{base:e.base,values:o}:e}function wt(e,t,n){const a=Object.fromEntries(Object.entries(t.base).map((([e,t])=>[e,{min:t,max:t}]))),i={arts:t};for(;;){const t=(0,gt.O)(T.eV,(e=>St(i.arts.values[e]))),l=(0,gt.O)(T.eV,(e=>kt(Object.entries(t).map((t=>t[0]===e?a:t[1])).filter((e=>e)))));let r=!1;const s=(0,gt.O)(T.eV,(t=>{const a=i.arts.values[t].filter((a=>{const i=kt([St([a]),l[t]]),r=Xt(e,i);return e.every(((e,t)=>{var a;return r.get(e).max>=(null!=(a=n[t])?a:-1/0)}))}));return a.length!==i.arts.values[t].length&&(r=!0),a}));if(!r)break;i.arts={base:i.arts.base,values:s}}return i.arts}function Bt(e,t){const n=Xt(e,kt([Object.fromEntries(Object.entries(t.base).map((([e,t])=>[e,{min:t,max:t}]))),...Object.values(t.values).map((e=>St(e)))]));return(0,yt.uW)(e,(e=>{{const{min:t,max:a}=n.get(e);if(t===a)return(0,bt.a9)(t)}const{operation:t}=e,a=e.operands.map((e=>n.get(e)));switch(t){case"threshold":{const[t,n,i,l]=a;if(t.min>=n.max)return e.operands[2];if(t.max<n.min)return e.operands[3];if(i.max===i.min&&l.max===l.min&&i.min===l.min&&isFinite(i.min))return(0,bt.a9)(i.max);break}case"min":{const t=e.operands.filter(((e,t)=>{const n=a[t];return a.every(((e,t)=>n.min<=e.max))}));if(t.length<a.length)return(0,bt.VV)(...t);break}case"max":{const t=e.operands.filter(((e,t)=>{const n=a[t];return a.every((e=>n.max>=e.min))}));if(t.length<a.length)return(0,bt.Fp)(...t);break}}return e}),(e=>e))}function kt(e){const t={};return e.forEach((e=>{Object.entries(e).forEach((([e,n])=>{t[e]?(t[e].min+=n.min,t[e].max+=n.max):t[e]=Object.assign({},n)}))})),t}function St(e){const t={};return e.length&&(Object.keys(e[0].values).filter((t=>e.every((e=>e.values[t])))).forEach((n=>t[n]={min:e[0].values[n],max:e[0].values[n]})),e.forEach((({values:e})=>{for(const[n,a]of Object.entries(e))t[n]?(t[n].max<a&&(t[n].max=a),t[n].min>a&&(t[n].min=a)):t[n]={min:0,max:a}}))),t}function Xt(e,t){const n=new Map;return(0,yt.aD)(e,(e=>{}),(e=>{var a;const{operation:i}=e,l=e.operands.map((e=>n.get(e)));let r;switch(i){case"read":if("dyn"!==e.path[0])throw new Error(`Found non-dyn path ${e.path} while computing range`);r=null!=(a=t[e.path[1]])?a:{min:0,max:0};break;case"const":r=Pt([e.value]);break;case"add":case"min":case"max":r={min:pt.aj[i](l.map((e=>e.min))),max:pt.aj[i](l.map((e=>e.max)))};break;case"res":r={min:pt.aj[i]([l[0].max]),max:pt.aj[i]([l[0].min])};break;case"mul":r=l.reduce(((e,t)=>Pt([e.min*t.min,e.min*t.max,e.max*t.min,e.max*t.max])));break;case"threshold":r=l[0].min>=l[1].max?l[2]:l[0].max<l[1].min?l[3]:Pt([],[l[2],l[3]]);break;case"sum_frac":{const[e,t]=l,n={min:e.min+t.min,max:e.max+t.max};r=n.min<=0&&n.max>=0?e.min<=0&&e.max>=0?{min:NaN,max:NaN}:{min:-1/0,max:1/0}:Pt([e.min/n.min,e.min/n.max,e.max/n.min,e.max/n.max]);break}default:(0,gt.UT)(i)}n.set(e,r)})),n}function Pt(e,t=[]){const n=Math.max(...e,...t.map((e=>e.max)));return{min:Math.min(...e,...t.map((e=>e.min))),max:n}}function Kt(e){return new Set(null!=e&&e.includes(2)?e.includes(4)?[0,1]:[0,1,4,5]:null!=e&&e.includes(4)?[0,1,2,3]:[0,1,2,3,4,5])}function*Ot(e,t){const n=[...new Set(t)],a=Kt(e.rainbow);let i=[];function l(e,t){if(!(0,gt.w6)(t+1,4).some((t=>5!==e[t])))return(e=[...e])[t]=5,e.reduce(((e,t)=>6*e+t),0)}!function e(t,n,l){if(5!==t.length){for(const a of n)e([...t,a],n,l.filter((e=>e!==a)));e([...t,t.length],new Set([...n,t.length]),[...l,t.length])}else a.has(l.length)&&i.push(t)}([0],new Set([0]),[0]);for(let Z=4;Z>=0;Z--){const e=new Map;for(const t of i){var r;const n=l(t,Z);void 0!==n&&e.set(n,(null!=(r=e.get(n))?r:new Set(t.slice(0,Z)).size+1)-1)}for(const[t,n]of e.entries())if(0===n){const e=[...i.find((e=>l(e,Z)===t))];e[Z]=5,i=i.filter((e=>l(e,Z)!==t)),i.push(e)}}const s={kind:"exclude",sets:new Set},c=(0,gt.O)(T.eV,(e=>s)),o=Object.assign({},(0,gt.xh)(e,(e=>0)),(0,gt.O)(n,(e=>0))),d=(0,gt.xh)(e,Kt);function*u(e){const t=new Set;let a=[],i=[];for(const n of e)a.push([]),5===n?i.push(a.length-1):a[n].push(a.length-1);a=a.filter((e=>e.length)).sort(((e,t)=>t.length-e.length));let l=i.length;function*r(e){const t=i.length-e,a=[],l=[],s=[];let u=0;for(const i of n){const e=d[i],n=o[i];e&&((0,gt.w6)(1,t).every((t=>!e.has(n+t)))?s.push(i):e.has(n)?(0,gt.w6)(0,t).some((t=>!e.has(n+t)))&&a.push(i):(u+=[...e].find((e=>e>n))-n,l.push(i)))}if(!(u>t))if(e!==i.length)if(u!==t){for(const t of[...a,...l])o[t]++,c[T.eV[i[e]]]={kind:"required",sets:new Set([t])},yield*r(e+1),o[t]--;c[T.eV[i[e]]]={kind:"exclude",sets:new Set([...l,...s,...a])},yield*r(e+1)}else for(const n of l)o[n]++,c[T.eV[i[e]]]={kind:"required",sets:new Set([n])},yield*r(e+1),o[n]--;else yield Object.assign({},c)}yield*function*e(i){if(i===a.length)return yield*r(0);for(const r of n){if(t.has(r))continue;const n=a[i].length,u=d[r];let Z=0;var s;if(u&&!u.has(n))if(Z=(null!=(s=(0,gt.w6)(n+1,5).find((e=>u.has(e))))?s:6)-n,Z>l)continue;t.add(r),o[r]=a[i].length,a[i].forEach((e=>c[T.eV[e]]={kind:"required",sets:new Set([r])})),l-=Z,yield*e(i+1),l+=Z,o[r]=0,t.delete(r)}}(0)}for(const Z of i)yield*u(Z)}var Et=n(9725),jt=n(67732),Dt=n(49810),It=n(74637),At=n(73740);function Rt({setKey:e,setNumKey:t,hideHeader:n=!1,conditionalsOnly:a=!1}){var i;const l=(0,R.Z)((()=>It.y.get(e)),[e]);if(!l)return null;const r=a?null==(i=l.setEffectDocument(t))?void 0:i.filter((e=>"states"in e)):l.setEffectDocument(t);return(0,z.tZ)(d.Z,{display:"flex",flexDirection:"column",children:r?(0,z.tZ)(At.Z,{sections:r,hideHeader:n}):null})}var Gt=n(9510),Mt=n(82334),Tt=n(71765),_t=n(21845),Vt=n(60184);function Nt(e){const{database:t}=(0,f.useContext)(E.t),[n,a]=(0,f.useState)((()=>t.buildSettings.get(e)));(0,f.useEffect)((()=>a(t.buildSettings.get(e))),[t,e]),(0,f.useEffect)((()=>t.buildSettings.follow(e,((e,t,n)=>"update"===t&&a(n)))),[e,a,t]);return{buildSetting:n,buildSettingDispatch:(0,f.useCallback)((n=>e&&t.buildSettings.set(e,n)),[e,t])}}let zt,Lt,qt,$t,Wt,Ft,Ht,Ut,Yt,Jt,Qt,en,tn,nn,an,ln,rn=e=>e;function sn({disabled:e}){var t,n;const{t:a}=(0,g.$G)(["page_character_optimize","sheet"]),i=(0,f.useContext)(X.R),{database:l}=(0,f.useContext)(E.t),{character:{key:r,conditional:s},characterDispatch:c}=(0,f.useContext)(S.K),{buildSetting:{artSetExclusion:o},buildSettingDispatch:u}=Nt(r),[h,p]=(0,f.useState)(!1),x=(0,f.useCallback)((()=>p(!0)),[p]),y=(0,f.useCallback)((()=>p(!1)),[p]),w=(0,R.Z)((()=>It.y.getAll),[]),[B,P]=(0,mt.Z)();(0,f.useEffect)((()=>l.arts.followAny(P)),[l,P]);const K=(0,f.useMemo)((()=>w?Object.entries(It.y.setKeysByRarities(w)).reverse().flatMap((([,e])=>e)).filter((e=>!e.includes("Prayers"))):[]),[w]),{artKeys:O,artSlotCount:j}=(0,f.useMemo)((()=>{const e=(0,gt.O)(K,(e=>(0,gt.O)(T.eV,(e=>0))));l.arts.values.forEach((t=>e[t.setKey]&&e[t.setKey][t.slotKey]++));const t=[...K].sort(((t,n)=>+(dn(e[t])<2)-+(dn(e[n])<2)));return B&&{artKeys:t,artSlotCount:e}}),[B,l,K]),D=!(null!=(t=o.rainbow)&&t.includes(2)),I=!(null!=(n=o.rainbow)&&n.includes(4)),{allow2:A,allow4:G}=(0,f.useMemo)((()=>({allow2:K.filter((e=>{var t;return!(null!=(t=o[e])&&t.includes(2))})).length,allow4:K.filter((e=>{var t;return!(null!=(t=o[e])&&t.includes(4))})).length})),[K,o]),M=K.length-A,_=K.length-G,V=(0,f.useMemo)((()=>Object.keys(s).filter((e=>T.q2.includes(e)&&s[e])).length),[s]),N=(0,f.useMemo)((()=>Object.assign({},i,{data:new le.w(Object.assign({},i.data.data[0],{artSet:(0,gt.O)(T.q2,(e=>(0,bt.a9)(4)))}),void 0)})),[i]),L=(0,f.useCallback)((()=>{const e=Object.fromEntries(Object.entries(s).filter((([e,t])=>!T.q2.includes(e))));c({conditional:e})}),[s,c]),q=(0,f.useCallback)(((e,t=!0)=>{const n=(0,gt.I8)(o);K.forEach((a=>{var i;t?n[a]=[...null!=(i=n[a])?i:[],e]:n[a]&&(n[a]=n[a].filter((t=>t!==e)))})),u({artSetExclusion:n})}),[K,o,u]);return(0,z.BX)(z.HY,{children:[(0,z.BX)(v.Z,{sx:{display:"flex"},children:[(0,z.BX)(Z.Z,{sx:{flexGrow:1},children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)("strong",{children:a(zt||(zt=rn`artSetConfig.title`))})}),(0,z.BX)(de.Z,{spacing:1,children:[(0,z.BX)(Y.Z,{children:[a(Lt||(Lt=rn`artSetConfig.setEffCond`))," ",(0,z.BX)(k.Z,{color:V?"success":"warning",children:[V," ",a("artSetConfig.enabled")]})]}),(0,z.BX)(Y.Z,{children:[a(qt||(qt=rn`sheet:2set`))," ",(0,z.BX)(k.Z,{color:"success",children:[A," ",(0,z.tZ)(jt.G,{icon:Et.Stf,className:"fa-fw"})," ",a("artSetConfig.allowed")]}),!!M&&" / ",!!M&&(0,z.BX)(k.Z,{color:"secondary",children:[M," ",(0,z.tZ)(jt.G,{icon:Et.gPx,className:"fa-fw"})," ",a("artSetConfig.excluded")]})]}),(0,z.BX)(Y.Z,{children:[a($t||($t=rn`sheet:4set`))," ",(0,z.BX)(k.Z,{color:"success",children:[G," ",(0,z.tZ)(jt.G,{icon:Et.Stf,className:"fa-fw"})," ",a("artSetConfig.allowed")]}),!!_&&" / ",!!_&&(0,z.BX)(k.Z,{color:"secondary",children:[_," ",(0,z.tZ)(jt.G,{icon:Et.gPx,className:"fa-fw"})," ",a("artSetConfig.excluded")]})]}),(0,z.BX)(Y.Z,{children:[a(Wt||(Wt=rn`artSetConfig.2rainbow`))," ",(0,z.BX)(k.Z,{color:D?"success":"secondary",children:[(0,z.tZ)(jt.G,{icon:D?Et.Stf:Et.gPx,className:"fa-fw"})," ",D?a("artSetConfig.allowed"):"Excluded"]})]}),(0,z.BX)(Y.Z,{children:[a(Ft||(Ft=rn`artSetConfig.4rainbow`))," ",(0,z.BX)(k.Z,{color:I?"success":"secondary",children:[(0,z.tZ)(jt.G,{icon:I?Et.Stf:Et.gPx,className:"fa-fw"})," ",I?a("artSetConfig.allowed"):"Excluded"]})]})]})]}),(0,z.tZ)(m.Z,{onClick:x,disabled:e,color:"info",sx:{borderRadius:0},children:(0,z.tZ)(Dt.Z,{})})]}),w&&(0,z.tZ)(ae.Z,{open:h,onClose:y,children:(0,z.BX)(b.Z,{children:[(0,z.BX)(Z.Z,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:[(0,z.tZ)(Y.Z,{variant:"h6",children:a(Ht||(Ht=rn`artSetConfig.title`))}),(0,z.tZ)(C.Z,{onClick:y})]}),(0,z.tZ)(F.Z,{}),(0,z.BX)(Z.Z,{children:[(0,z.tZ)(v.Z,{sx:{mb:1},children:(0,z.BX)(Z.Z,{children:[(0,z.BX)(d.Z,{display:"flex",gap:1,children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)("strong",{children:a(Ut||(Ut=rn`artSetConfig.modal.setCond.title`))})}),(0,z.tZ)(Y.Z,{sx:{flexGrow:1},children:(0,z.BX)(k.Z,{color:V?"success":"warning",children:[V," ",a("artSetConfig.selected")]})}),(0,z.tZ)(m.Z,{size:"small",onClick:L,color:"error",startIcon:(0,z.tZ)(he.Z,{}),children:a(Yt||(Yt=rn`artSetConfig.modal.setCond.reset`))})]}),(0,z.tZ)(Y.Z,{children:a(Jt||(Jt=rn`artSetConfig.modal.setCond.text`))})]})}),(0,z.tZ)(v.Z,{sx:{mb:1},children:(0,z.BX)(Z.Z,{children:[(0,z.tZ)(Y.Z,{sx:{flexGrow:1},children:(0,z.tZ)("strong",{children:(0,z.BX)(g.cC,{t:a,i18nKey:"artSetConfig.modal.ArtSetFilter.title",children:["Artifact Sets ",(0,z.BX)(te.Z,{color:"success",children:["Allowed",(0,z.tZ)(jt.G,{icon:Et.Stf,className:"fa-fw"})]})," / ",(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluded",(0,z.tZ)(jt.G,{icon:Et.gPx,className:"fa-fw"})]})]})})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(g.cC,{t:a,i18nKey:"artSetConfig.modal.ArtSetFilter.intro",children:["You can allow/exclude which sets you want the builder to consider. In the following examples, ",(0,z.tZ)("strong",{children:"A"})," is on-set, and ",(0,z.tZ)("strong",{children:"R"})," is rainbow(off-set)"]})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(g.cC,{t:a,i18nKey:"artSetConfig.modal.ArtSetFilter.2set",children:[(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.tZ)(jt.G,{icon:Et.gPx,className:"fa-fw"})," 2-Set"]})})," would exclude 2-Set builds: ",(0,z.BX)("strong",{children:[(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"AA"}),"RRR"]})," and ",(0,z.BX)("strong",{children:[(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"AAA"}),"RR"]}),"."]})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(g.cC,{t:a,i18nKey:"artSetConfig.modal.ArtSetFilter.4set",children:[(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.tZ)(jt.G,{icon:Et.gPx,className:"fa-fw"})," 4-Set"]})})," would exclude 4-Set builds: ",(0,z.BX)("strong",{children:[(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"AAAA"}),"R"]})," and ",(0,z.tZ)("strong",{children:(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"AAAAA"})}),"."]})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(g.cC,{t:a,i18nKey:"artSetConfig.modal.ArtSetFilter.2rain",children:[(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.tZ)(jt.G,{icon:Et.gPx,className:"fa-fw"})," 3-Rainbow"]})})," would exclude 2-Set + 3-Rainbow builds: ",(0,z.BX)("strong",{children:["AA",(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"RRR"})]})," and ",(0,z.BX)("strong",{children:["AAA",(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"RR"})]}),"."]})}),(0,z.tZ)(Y.Z,{children:(0,z.BX)(g.cC,{t:a,i18nKey:"artSetConfig.modal.ArtSetFilter.4rain",children:[(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Excluding",(0,z.tZ)(jt.G,{icon:Et.gPx,className:"fa-fw"})," 5-Rainbow"]})})," would exclude full 5-Rainbow builds: ",(0,z.tZ)("strong",{children:(0,z.tZ)(te.Z,{color:"secondary",variant:"light",children:"RRRRR"})}),"."]})})]})}),(0,z.BX)(ue.ZP,{container:!0,columns:{xs:2,lg:3},sx:{mb:1},spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(cn,{setNum:2,numAllow:A,numExclude:M,setAllExclusion:q})}),(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(cn,{setNum:4,numAllow:G,numExclude:_,setAllExclusion:q})}),(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(v.Z,{children:(0,z.BX)(Z.Z,{children:[(0,z.tZ)(Y.Z,{gutterBottom:!0,children:(0,z.tZ)("strong",{children:(0,z.BX)(g.cC,{t:a,i18nKey:"artSetConfig.alExRainbow",children:[(0,z.BX)(te.Z,{color:"success",children:["Allow ",(0,z.tZ)(jt.G,{icon:Et.Stf,className:"fa-fw"})]})," / ",(0,z.BX)(te.Z,{color:"secondary",variant:"light",children:["Exclude ",(0,z.tZ)(jt.G,{icon:Et.gPx,className:"fa-fw"})]})," Rainbow Builds"]})})}),(0,z.BX)(d.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(m.Z,{fullWidth:!0,onClick:()=>u({artSetExclusion:(0,Vt.s)(o,"rainbow",2)}),color:D?"success":"secondary",startIcon:D?(0,z.tZ)(pe.Z,{}):(0,z.tZ)(me.Z,{}),endIcon:(0,z.tZ)(jt.G,{icon:D?Et.Stf:Et.gPx,className:"fa-fw"}),children:a(Qt||(Qt=rn`artSetConfig.2rainbow`))}),(0,z.tZ)(m.Z,{fullWidth:!0,onClick:()=>u({artSetExclusion:(0,Vt.s)(o,"rainbow",4)}),color:I?"success":"secondary",startIcon:I?(0,z.tZ)(pe.Z,{}):(0,z.tZ)(me.Z,{}),endIcon:(0,z.tZ)(jt.G,{icon:I?Et.Stf:Et.gPx,className:"fa-fw"}),children:a(en||(en=rn`artSetConfig.4rainbow`))})]})]})})})]}),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,lg:3},children:O.map((e=>(0,z.tZ)(on,{setKey:e,sheet:w(e),fakeDataContextObj:N,slotCount:j[e]},e)))})]}),(0,z.tZ)(F.Z,{}),(0,z.tZ)(Z.Z,{sx:{py:1},children:(0,z.tZ)(C.Z,{large:!0,onClick:y})})]})})]})}function cn({numAllow:e,numExclude:t,setNum:n,setAllExclusion:a}){const{t:i}=(0,g.$G)(["page_character_optimize","sheet"]);return(0,z.tZ)(v.Z,{children:(0,z.BX)(Z.Z,{children:[(0,z.BX)(Y.Z,{gutterBottom:!0,children:[(0,z.tZ)("strong",{children:i(`sheet:${n}set`)})," ",(0,z.BX)(k.Z,{color:"success",children:[e," ",(0,z.tZ)(jt.G,{icon:Et.Stf,className:"fa-fw"})," ",i("artSetConfig.allowed")]}),!!t&&" / ",!!t&&(0,z.BX)(k.Z,{color:"secondary",children:[t," ",(0,z.tZ)(jt.G,{icon:Et.gPx,className:"fa-fw"})," ",i("artSetConfig.excluded")]})]}),(0,z.BX)(d.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(m.Z,{fullWidth:!0,disabled:!t,onClick:()=>a(n,!1),color:"success",startIcon:(0,z.tZ)(jt.G,{icon:Et.Stf,className:"fa-fw"}),children:i(`artSetConfig.allowAll${n}set`)}),(0,z.tZ)(m.Z,{fullWidth:!0,disabled:!e,onClick:()=>a(n,!0),color:"secondary",startIcon:(0,z.tZ)(jt.G,{icon:Et.gPx,className:"fa-fw"}),children:i(`artSetConfig.excludeAll${n}set`)})]})]})})}function on({sheet:e,setKey:t,fakeDataContextObj:n,slotCount:a}){var i,l;const{t:r}=(0,g.$G)("sheet"),{character:{key:s}}=(0,f.useContext)(S.K),{buildSetting:c,buildSettingDispatch:o}=Nt(s),{artSetExclusion:u}=c,h=null!=(i=null==u?void 0:u[t])?i:[],p=!h.includes(4),x=(0,f.useMemo)((()=>dn(a)),[a]),y=(0,f.useMemo)((()=>p?Object.keys(e.setEffects).filter((t=>{var n;return null==(n=e.setEffects[t])?void 0:n.document.some((e=>"states"in e))})):[]),[e.setEffects,p]),b=h.includes(2),C=h.includes(4);return(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.BX)(v.Z,{sx:{height:"100%",opacity:x<2?"50%":void 0},children:[(0,z.BX)(d.Z,{className:`grad-${e.rarity[0]}star`,width:"100%",sx:{display:"flex"},children:[(0,z.tZ)(d.Z,{component:"img",src:e.defIconSrc,sx:{height:100,width:"auto",mx:-1}}),(0,z.BX)(d.Z,{sx:{flexGrow:1,px:1,display:"flex",flexDirection:"column",justifyContent:"center"},children:[(0,z.tZ)(Y.Z,{variant:"h6",children:null!=(l=e.name)?l:""}),(0,z.BX)(d.Z,{display:"flex",gap:1,children:[(0,z.tZ)(Y.Z,{variant:"subtitle1",children:e.rarity.map(((t,n)=>(0,z.BX)("span",{children:[t," ",(0,z.tZ)(Tt.q,{stars:1})," ",n<e.rarity.length-1?"/ ":null]},t)))}),(0,z.tZ)(Mt.Z,{title:(0,z.BX)(d.Z,{children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)(k.Z,{color:"success",children:r(tn||(tn=rn`2set`))})}),(0,z.tZ)(Y.Z,{children:(0,z.tZ)(_t.v,{ns:`artifact_${t}_gen`,key18:"setEffects.2"})}),(0,z.BX)(d.Z,{paddingTop:2,sx:{opacity:h.includes(4)?.6:1},children:[(0,z.tZ)(Y.Z,{children:(0,z.tZ)(k.Z,{color:"success",children:r(nn||(nn=rn`4set`))})}),(0,z.tZ)(Y.Z,{children:(0,z.tZ)(_t.v,{ns:`artifact_${t}_gen`,key18:"setEffects.4"})})]})]})})]}),(0,z.tZ)(d.Z,{sx:{display:"flex",gap:1},children:Object.entries(a).map((([e,t])=>(0,z.tZ)(Y.Z,{sx:{flexGrow:1},variant:"subtitle2",children:(0,z.BX)(k.Z,{sx:{width:"100%"},color:t?"primary":"secondary",children:[(0,Gt.Ir)(e),t]})},e)))})]})]}),(0,z.BX)(Se.Z,{sx:{".MuiButton-root":{borderRadius:0}},fullWidth:!0,children:[(0,z.tZ)(m.Z,{startIcon:b?(0,z.tZ)(me.Z,{}):(0,z.tZ)(pe.Z,{}),onClick:()=>o({artSetExclusion:(0,Vt.s)(u,t,2)}),color:b?"secondary":"success",endIcon:(0,z.tZ)(jt.G,{icon:b?Et.gPx:Et.Stf,className:"fa-fw"}),children:r(an||(an=rn`2set`))}),(0,z.tZ)(m.Z,{startIcon:C?(0,z.tZ)(me.Z,{}):(0,z.tZ)(pe.Z,{}),onClick:()=>o({artSetExclusion:(0,Vt.s)(u,t,4)}),color:C?"secondary":"success",endIcon:(0,z.tZ)(jt.G,{icon:C?Et.gPx:Et.Stf,className:"fa-fw"}),children:r(ln||(ln=rn`4set`))})]}),!!y.length&&(0,z.tZ)(X.R.Provider,{value:n,children:(0,z.tZ)(Z.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:y.map((e=>(0,z.tZ)(Rt,{setKey:t,setNumKey:parseInt(e),hideHeader:!0,conditionalsOnly:!0},e)))})})]})},t)}function dn(e){return Object.values(e).reduce(((e,t)=>e+(t?1:0)),0)}const un=[0,4,8,12,16,20];function Zn({mainStatAssumptionLevel:e=0,setmainStatAssumptionLevel:t,disabled:n}){const{t:a}=(0,g.$G)("page_character_optimize");return(0,z.tZ)(ot.Z,{fullWidth:!0,color:e?"success":"primary",disabled:n,title:e?a("mainStat.assumptionLvl.lvl",{lvl:e}):a("mainStat.assumptionLvl.no"),children:un.map((e=>(0,z.tZ)(it.Z,{onClick:()=>t(e),children:e?a("mainStat.assumptionLvl.lvl",{lvl:e}):a("mainStat.assumptionLvl.no")},e)))})}function hn(){const{character:{bonusStats:e}}=(0,f.useContext)(S.K),{data:t}=(0,f.useContext)(X.R),n=Object.keys(e);if(!n.length)return null;const a=n.map((e=>t.get(xe.ri.customBonus[e])));return(0,z.BX)(v.Z,{children:[(0,z.tZ)(Z.Z,{children:(0,z.tZ)(Y.Z,{children:"Bonus Stats"})}),(0,z.tZ)(F.Z,{}),(0,z.tZ)(Z.Z,{children:a.map((e=>(0,z.tZ)(Ge.JW,{node:e},JSON.stringify(e.info))))})]})}var pn=n(38162),mn=n(21940);const fn=(0,ve.ZP)("strong")({fontFamily:"monospace"}),gn=(0,ve.ZP)(pn.Z)((({theme:e})=>({height:10,borderRadius:5})));function xn({status:{type:e,tested:t,failed:n,skipped:a,total:i,startTime:l,finishTime:r},characterName:s}){const c=isFinite(i),o="inactive"!==e,d=i-a,u=(0,z.tZ)(fn,{children:t.toLocaleString()}),Z=(0,z.tZ)(fn,{children:d.toLocaleString()}),h=!!a&&(0,z.BX)("span",{children:["(",(0,z.tZ)("b",{children:(0,z.tZ)(fn,{children:a.toLocaleString()})})," skipped)"]}),p=(0,z.tZ)(fn,{children:(0,mn.e6)(Math.round((null!=r?r:performance.now())-(null!=l?l:NaN)))});let m,f="",g="";if(o)m=100*t/d,f=(0,z.BX)(Y.Z,{children:["Generating and testing ",u,c?(0,z.BX)(z.HY,{children:["/",Z]}):void 0," build configurations against the criteria for ",(0,z.tZ)("b",{children:s}),". ",h]}),g=(0,z.BX)(Y.Z,{children:["Time elapsed: ",p]});else{if(!(t+a))return null;m=100,f=(0,z.BX)(Y.Z,{children:["Generated and tested ",u," Build configurations against the criteria for ",(0,z.tZ)("b",{children:s}),". ",h]}),g=(0,z.BX)(Y.Z,{children:["Total duration: ",p]})}return(0,z.BX)(nt.Z,{severity:"success",variant:"filled",sx:{"& .MuiAlert-message":{flexGrow:1}},children:[f,g,void 0!==m&&(0,z.BX)(ue.ZP,{container:!0,spacing:1,alignItems:"center",children:[c&&(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(Y.Z,{children:`${m.toFixed(1)}%`})}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(gn,{variant:c?"determinate":"indeterminate",value:m,color:"primary"})})]})]})}var yn=n(74064),bn=n(73673),vn=n(66615),Cn=n(75213),wn=n(47746),Bn=n(47591),kn=n(79536),Sn=n(54878),Xn=n(53163),Pn=n(57889),Kn=n(34612),On=n(9985);function En({artifactId:e,slotKey:t,mainStatAssumptionLevel:n=0,showLocation:a=!1,onClick:i,BGComponent:l=b.Z}){var r,s;const c=(0,Xn.Z)(e),{database:o}=(0,f.useContext)(E.t),u=(0,R.Z)((()=>It.y.get(null==c?void 0:c.setKey)),[null==c?void 0:c.setKey]),Z=(0,f.useCallback)((e=>(0,z.tZ)(Cn.Z,{onClick:i,sx:{height:"100%"},children:e})),[i]),h=(0,wn.Z)();if(!c)return(0,z.tZ)(l,{sx:{display:"flex",height:"100%",alignItems:"center",justifyContent:"center"},children:(0,z.tZ)(d.Z,{component:"img",src:kn.Z.slot[t],sx:{width:"25%",height:"auto",opacity:.7}})});const{slotKey:p,rarity:m,level:g,mainStatKey:x,substats:y,location:v}=c,C=Math.max(Math.min(n,4*m),g),w=ye.ZP.unit(x),B=T.Kj.find((e=>c.mainStatKey.includes(e))),k=B?(0,Bn.Fq)(h.palette[B].main,.6):(0,Bn.Fq)(h.palette.secondary.main,.6);return(0,z.tZ)(l,{sx:{height:"100%"},children:(0,z.tZ)(Pn.Z,{condition:!!i,wrapper:Z,children:(0,z.BX)(d.Z,{display:"flex",height:"100%",children:[(0,z.BX)(d.Z,{className:`grad-${m}star`,sx:{position:"relative",flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},children:[(0,z.tZ)(On.Z,{art:c,children:(0,z.tZ)(d.Z,{component:"img",src:null!=(r=null==u?void 0:u.slotIcons[p])?r:"",sx:{m:-1,maxHeight:"110%",maxWidth:"110%"}})}),(0,z.BX)(d.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"space-between",pointerEvents:"none"},children:[(0,z.tZ)(fe.Z,{size:"small",label:(0,z.tZ)("strong",{children:` +${g}`}),color:Sn.ZP.levelVariant(g)}),a&&(0,z.tZ)(fe.Z,{size:"small",label:(0,z.tZ)(Dn,{charKey:v&&o.chars.LocationToCharacterKey(v)}),color:"secondary",sx:{overflow:"visible",".MuiChip-label":{overflow:"visible"}}})]}),(0,z.tZ)(fe.Z,{size:"small",sx:{position:"absolute",bottom:0,mb:1,backgroundColor:k},label:(0,z.BX)(Y.Z,{sx:{display:"flex",gap:.5,px:1,zIndex:1},children:[(0,z.tZ)(st.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:(0,z.tZ)(Kn._,{statKey:x})}),disableInteractive:!0,children:(0,z.tZ)("span",{children:ke.Z[x]})}),(0,z.BX)(te.Z,{color:C!==g?"warning":void 0,children:[(0,ye.qs)(null!=(s=Sn.ZP.mainStatValue(x,m,C))?s:0,ye.ZP.unit(x)),w]})]})})]}),(0,z.tZ)(d.Z,{display:"flex",flexDirection:"column",justifyContent:"space-between",sx:{p:1},children:y.map(((e,t)=>(0,z.tZ)(jn,{stat:e},t+e.key)))})]})})})}function jn({stat:e}){var t,n;if(!e.value)return null;const a=null!=(t=null==(n=e.rolls)?void 0:n.length)?t:0,i=`roll${(0,gt.uZ)(a,1,6)}`,l=ye.ZP.unit(e.key);return(0,z.tZ)(d.Z,{display:"flex",gap:1,alignContent:"center",children:(0,z.BX)(Y.Z,{sx:{flexGrow:1,display:"flex",gap:.5},color:a?`${i}.main`:"error.main",component:"span",children:[(0,z.tZ)(st.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:e.key&&(0,z.tZ)(Kn._,{statKey:e.key})}),disableInteractive:!0,children:(0,z.tZ)("span",{children:ke.Z[e.key]})}),(0,z.tZ)("span",{children:`${(0,ye.qs)(e.value,ye.ZP.unit(e.key))}${l}`})]})})}function Dn({charKey:e}){const{gender:t}=(0,A.Z)(),n=(0,R.Z)((()=>O.Z.get(e,t)),[e,t]);return n?(0,z.tZ)(st.Z,{placement:"right-end",title:(0,z.tZ)(Y.Z,{children:n.name}),children:(0,z.tZ)(ne.Z,{src:n.thumbImgSide,size:2.5,sx:{marginTop:"-1.5em",marginLeft:"-0.5em"}})}):(0,z.tZ)(vn.Z,{})}var In=n(60342);function An(){const{data:e}=(0,f.useContext)(X.R),t=(0,f.useMemo)((()=>(0,ie.U)(e).filter((([,e])=>Object.values(e).some((e=>!e.isEmpty))))),[e]);return(0,z.tZ)(d.Z,{sx:{mr:-1,mb:-1},children:(0,z.tZ)(In.ZP,{columns:{xs:1,sm:2,md:3,xl:4},spacing:1,children:t.map((([e,t])=>(0,z.tZ)(Rn,{displayNs:t,sectionKey:e},e)))})})}function Rn({displayNs:e,sectionKey:t}){const n=(0,f.useContext)(ut),{data:a,oldData:i}=(0,f.useContext)(X.R),{database:l}=(0,f.useContext)(E.t),r=(0,R.Z)((()=>(0,ie.f)(a,t,l)),[a,t]),s=(0,f.useMemo)((()=>(0,gt.xh)(e,((e,n)=>(0,bt.UF)(["display",t,n])))),[e,t]);if(!r)return(0,z.tZ)(b.Z,{});const{title:c,icon:o,action:d}=r;return(0,z.BX)(b.Z,{children:[(0,z.tZ)(ee.Z,{avatar:o&&(0,z.tZ)(ne.Z,{size:2,sx:{m:-1},src:o}),title:c,action:d&&(0,z.tZ)(k.Z,{children:d})}),(0,z.tZ)(F.Z,{}),(0,z.tZ)(Ge.lD,{sx:{m:0},children:Object.entries(e).map((([e,a])=>(0,z.tZ)(Ge.JW,{node:a,oldValue:i?i.get(s[e]).value:void 0,component:Ze.ZP,emphasize:JSON.stringify(n)===JSON.stringify([t,e])},e)))})]})}var Gn=n(71026),Mn=n(94758),Tn=n(2031);function _n({weaponId:e,showLocation:t=!1,onClick:n,BGComponent:a=b.Z}){const i=(0,Mn.Z)(e),l=(0,R.Z)((()=>(null==i?void 0:i.key)&&Gn.Z.get(i.key)),[null==i?void 0:i.key]),r=(0,f.useCallback)((e=>(0,z.tZ)(Cn.Z,{sx:{height:"100%"},onClick:n,children:e})),[n]),s=(0,f.useMemo)((()=>l&&i&&(0,ht.mP)([l.data,(0,ht.v0)(i)])),[l,i]);if(!i||!l||!s)return(0,z.tZ)(a,{sx:{height:"100%"},children:(0,z.tZ)(u.Z,{variant:"rectangular",sx:{width:"100%",height:"100%"}})});const{refinement:c,location:o}=i;return(0,z.tZ)(a,{sx:{height:"100%"},children:(0,z.tZ)(Pn.Z,{condition:!!n,wrapper:r,children:(0,z.BX)(d.Z,{display:"flex",height:"100%",alignItems:"stretch",children:[(0,z.BX)(d.Z,{className:`grad-${l.rarity}star`,sx:{height:"100%",position:"relative",flexGrow:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"flex-end"},children:[(0,z.tZ)(Tn.Z,{sheet:l,children:(0,z.tZ)(d.Z,{component:"img",src:l.getImg(i.ascension),sx:{mx:-1,maxHeight:"100%",maxWidth:"100%"}})}),(0,z.BX)(d.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"space-between",pointerEvents:"none"},children:[(0,z.tZ)(fe.Z,{size:"small",label:(0,z.tZ)("strong",{children:Gn.Z.getLevelString(i)}),color:"primary"}),t&&(0,z.tZ)(fe.Z,{size:"small",label:(0,z.tZ)(Nn,{location:o}),color:"secondary",sx:{overflow:"visible",".MuiChip-label":{overflow:"visible"}}})]}),(0,z.tZ)(d.Z,{sx:{position:"absolute",width:"100%",height:"100%",p:.5,opacity:.85,display:"flex",justifyContent:"flex-end",alignItems:"flex-end"},children:l.hasRefinement&&(0,z.tZ)(fe.Z,{size:"small",color:"info",label:(0,z.BX)("strong",{children:["R",c]})})})]}),(0,z.BX)(d.Z,{display:"flex",flexDirection:"column",sx:{p:1},children:[(0,z.tZ)(Vn,{node:s.get(xe.qH.weapon.main)}),(0,z.tZ)(Vn,{node:s.get(xe.qH.weapon.sub)})]})]})})})}function Vn({node:e}){return e.info.name?(0,z.tZ)(d.Z,{display:"flex",gap:1,alignContent:"center",children:(0,z.BX)(Y.Z,{sx:{flexGrow:1,display:"flex",gap:1},component:"span",children:[(0,z.tZ)(st.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:e.info.name}),disableInteractive:!0,children:(0,z.tZ)("span",{children:e.info.icon})}),(0,z.tZ)("span",{children:(0,le.p)(e)})]})}):null}function Nn({location:e}){const{database:t}=(0,f.useContext)(E.t),{gender:n}=(0,A.Z)(),a=(0,R.Z)((()=>O.Z.get(e?t.chars.LocationToCharacterKey(e):"",n)),[e,n]);return a?(0,z.tZ)(st.Z,{placement:"right-end",title:(0,z.tZ)(Y.Z,{children:a.name}),children:(0,z.tZ)(ne.Z,{src:a.thumbImgSide,size:2.5,sx:{marginTop:"-1.5em",marginLeft:"-0.5em"}})}):(0,z.tZ)(vn.Z,{})}var zn=n(85563),Ln=n(85213);function qn({artifacts:e,currentlyEquipped:t=!1}){const n=(0,f.useMemo)((()=>e.filter((e=>e)).reduce(((e,t)=>(e[t.setKey]?e[t.setKey].push(t.slotKey):e[t.setKey]=[t.slotKey],e)),{})),[e]);return(0,z.tZ)(z.HY,{children:Object.entries(n).sort((([e,t],[n,a])=>a.length-t.length)).map((([e,n])=>(0,z.tZ)($n,{setKey:e,currentlyEquipped:t,slotarr:n},e)))})}function $n({setKey:e,currentlyEquipped:t=!1,slotarr:n}){var a;const i=(0,R.Z)((()=>It.y.get(e)),[]);if(!i)return null;const l=n.length,r=Object.keys(i.setEffects).map((e=>parseInt(e))).filter((e=>e<=l));return(0,z.tZ)(d.Z,{children:(0,z.tZ)(Ln.Z,{artifactSheet:i,numInSet:l,children:(0,z.tZ)(k.Z,{sx:{height:"100%"},color:t?"success":"primary",children:(0,z.BX)(Y.Z,{children:[n.map((e=>(0,Gt.Ir)(e)))," ",null!=(a=i.name)?a:"",r.map((e=>(0,z.tZ)(k.Z,{sx:{ml:.5},color:"success",children:e},e)))]})})})})}function Wn({label:e,compareBuild:t,extraButtonsRight:n,extraButtonsLeft:a,disabled:i}){const{character:{key:l,equippedArtifacts:r}}=(0,f.useContext)(S.K),{buildSetting:{mainStatAssumptionLevel:s}}=Nt(l),{database:c}=(0,f.useContext)(E.t),o=(0,f.useContext)(X.R),{data:h,oldData:p}=o,[g,x]=(0,f.useState)(void 0),y=(0,f.useCallback)((()=>x(void 0)),[x]),b=(0,f.useCallback)((()=>{if(!window.confirm("Do you want to equip this build to this character?"))return;const e=c.chars.get(l);if(!e)return;T.eV.forEach((t=>{const n=h.get(xe.ri.art[t].id).value;if(n)c.arts.set(n,{location:(0,T.V7)(l)});else{const n=e.equippedArtifacts[t];n&&c.arts.get(n)&&c.arts.set(n,{location:""})}}));const t=h.get(xe.ri.weapon.id).value;t&&c.weapons.set(t,{location:(0,T.V7)(l)})}),[l,h,c]),C=(0,f.useMemo)((()=>{const e=Object.assign({},o);return t||(e.oldData=void 0),e}),[o,t]),w=(0,f.useMemo)((()=>Object.fromEntries(T.eV.map((e=>[e,h.get(xe.ri.art[e].id).value])))),[h]),B=(0,f.useMemo)((()=>w&&Object.values(w).map((e=>c.arts.get(e))).filter((e=>e))),[w,c.arts]),P=(0,f.useMemo)((()=>T.eV.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(En,{showLocation:!0,slotKey:e,artifactId:w[e],mainStatAssumptionLevel:s,onClick:()=>{const t=r[e],n=w[e];x({oldId:t!==n?t:void 0,newId:n})}})},e)))),[x,r,s,w]);if(!p)return null;const K=T.eV.every((e=>w[e]===p.get(xe.ri.art[e].id).value))&&h.get(xe.ri.weapon.id).value===p.get(xe.ri.weapon.id).value;return(0,z.tZ)(v.Z,{children:(0,z.BX)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:600}),children:[g&&(0,z.tZ)(Fn,{newOld:g,mainStatAssumptionLevel:s,onClose:y}),(0,z.BX)(Z.Z,{children:[(0,z.BX)(d.Z,{display:"flex",gap:1,sx:{pb:1},flexWrap:"wrap",children:[void 0!==e&&(0,z.tZ)(k.Z,{color:"info",children:(0,z.tZ)(Y.Z,{children:(0,z.BX)("strong",{children:[e,K?" (Equipped)":""]})})}),(0,z.tZ)(qn,{artifacts:B,currentlyEquipped:K}),(0,z.tZ)(d.Z,{sx:{flexGrow:1,display:"flex",justifyContent:"flex-end"}}),a,(0,z.tZ)(m.Z,{size:"small",color:"success",onClick:b,disabled:i||K,startIcon:(0,z.tZ)(yn.Z,{}),children:"Equip Build"}),n]}),(0,z.BX)(ue.ZP,{container:!0,spacing:1,sx:{pb:1},columns:{xs:2,sm:3,md:4,lg:6},children:[(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(_n,{showLocation:!0,weaponId:h.get(xe.ri.weapon.id).value})}),P]}),(0,z.tZ)(X.R.Provider,{value:C,children:(0,z.tZ)(An,{})})]})]})})}function Fn({newOld:{newId:e,oldId:t},mainStatAssumptionLevel:n,onClose:a}){const{database:i}=(0,f.useContext)(E.t),{character:{key:l}}=(0,f.useContext)(S.K),r=(0,f.useCallback)((()=>{window.confirm("Do you want to equip this artifact to this character?")&&(i.arts.set(e,{location:(0,T.V7)(l)}),a())}),[e,i,l,a]);return(0,z.tZ)(ae.Z,{open:!!e,onClose:a,containerProps:{maxWidth:t?"md":"xs"},children:(0,z.tZ)(b.Z,{children:(0,z.BX)(Z.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"stretch",gap:2,height:"100%"},children:[t&&(0,z.tZ)(d.Z,{minWidth:320,children:(0,z.tZ)(zn.Z,{artifactId:t,mainStatAssumptionLevel:n,canExclude:!0,canEquip:!0,editorProps:{disableSet:!0,disableSlot:!0}})}),t&&(0,z.tZ)(d.Z,{display:"flex",flexGrow:1}),t&&(0,z.tZ)(d.Z,{display:"flex",alignItems:"center",justifyContent:"center",children:(0,z.tZ)(m.Z,{onClick:r,sx:{display:"flex"},children:(0,z.tZ)(bn.Z,{sx:{fontSize:40}})})}),t&&(0,z.tZ)(d.Z,{display:"flex",flexGrow:1}),(0,z.tZ)(d.Z,{minWidth:320,children:(0,z.tZ)(zn.Z,{artifactId:e,mainStatAssumptionLevel:n,canExclude:!0,canEquip:!0,editorProps:{disableSet:!0,disableSlot:!0}})})]})})})}var Hn=n(68164),Un=n(73256),Yn=n(61660),Jn=n(58030),Qn=n(55484),ea=n(25556),ta=n(81224),na=n(3131),aa=n(47857),ia=n(55734),la=n(63004),ra=n(36197);function sa(e){const{database:t}=(0,f.useContext)(E.t),[n,a]=(0,f.useState)((()=>t.buildResult.get(e)));(0,f.useEffect)((()=>a(t.buildResult.get(e))),[t,e]),(0,f.useEffect)((()=>t.buildResult.follow(e,((e,t,n)=>"update"===t&&a(n)))),[e,a,t]);return{buildResult:n,buildResultDispatch:(0,f.useCallback)((n=>e&&t.buildResult.set(e,n)),[e,t])}}var ca=n(85090);function oa({cx:e,cy:t,payload:n,selectedPoint:a,radiusSelected:i=6,radiusUnselected:l=3,colorSelected:r="red",colorUnselected:s,shape:c="circle"}){if(!e||!t||!n)return null;const o=a&&a.x===n.x&&a.y===n.y;return(0,z.tZ)("g",{className:"custom-dot","data-chart-x":e,"data-chart-y":t,"data-x-value":n.x,"data-y-value":n.y,"data-radius":o?l:i,children:o?(0,z.BX)(z.HY,{children:[(0,z.tZ)(da,{id:"customShapeSelected",shape:c,cx:e,cy:t,r:i/2,fill:r}),(0,z.tZ)(da,{id:"customShapeBorder",shape:c,cx:e,cy:t,r:i,fill:"none",stroke:r})]}):(0,z.tZ)(da,{id:"customShapeUnselected",shape:c,cx:e,cy:t,r:l,fill:s})})}function da({shape:e,id:t,cx:n,cy:a,r:i,fill:l,stroke:r}){switch(e){case"circle":return(0,z.tZ)("circle",{id:t,cx:n,cy:a,r:i,fill:l,stroke:r});case"square":return(0,z.tZ)("rect",{id:t,x:n-i,y:a-i,width:2*i,height:2*i,fill:l,stroke:r});case"diamond":return(0,z.tZ)("polygon",{id:t,points:`${n},${a+2.5*i} ${n+1.5*i},${a} ${n},${a-2.5*i} ${n-1.5*i},${a}`,fill:l,stroke:r})}}var ua=n(99118),Za=n(69777);const ha=["xLabel","xUnit","yLabel","yUnit","selectedPoint","setSelectedPoint","addBuildToList"];function pa(e){let{xLabel:t,xUnit:n,yLabel:a,yUnit:i,selectedPoint:l,setSelectedPoint:r,addBuildToList:s}=e,c=(0,be.Z)(e,ha);const{database:o}=(0,f.useContext)(E.t),{data:d}=(0,f.useContext)(X.R),{t:h}=(0,g.$G)("page_character_optimize"),{graphBuilds:p}=(0,f.useContext)(K),{character:{key:x}}=(0,f.useContext)(S.K),{buildResult:{builds:y}}=sa(x),v=(0,f.useMemo)((()=>![...y,...null!=p?p:[]].some((e=>e.every((e=>null==l?void 0:l.artifactIds.includes(e)))))),[y,p,l]),w=(0,f.useMemo)((()=>l&&l.artifactIds&&Object.fromEntries(l.artifactIds.map((e=>{const t=o.arts.get(e);return[null==t?void 0:t.slotKey,t]})).filter((e=>e)))),[o.arts,l]),B=(0,f.useCallback)((e=>{e.target.id.includes("customShape")||e.target.id.includes("chartContainer")||r(void 0)}),[r]),P=w&&T.eV.every((e=>{var t;return(null==(t=w[e])?void 0:t.id)===d.get(xe.qH.art[e].id).value}));return c.active&&l?(0,z.tZ)(ua.Z,{onClickAway:B,children:(0,z.tZ)(b.Z,{sx:{minWidth:"400px",maxWidth:"400px"},onClick:e=>e.stopPropagation(),children:(0,z.tZ)(Z.Z,{children:(0,z.BX)(de.Z,{gap:1,children:[(0,z.BX)(de.Z,{direction:"row",alignItems:"start",gap:1,children:[(0,z.BX)(de.Z,{spacing:.5,flexGrow:99,children:[P&&(0,z.tZ)(k.Z,{color:"info",children:(0,z.tZ)("strong",{children:h("currentlyEquippedBuild")})}),(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{width:300,height:50}),children:(0,z.tZ)(qn,{artifacts:Object.values(w),currentlyEquipped:P})})]}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1}),(0,z.tZ)(C.Z,{onClick:()=>r(void 0)})]}),(0,z.tZ)(ue.ZP,{container:!0,direction:"row",spacing:.75,columns:5,children:T.eV.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{width:75,height:75}),children:(0,z.tZ)(Za.Z,{artifactObj:w[e],slotKey:e})})},e)))}),(0,z.BX)(Y.Z,{children:[(0,z.tZ)("strong",{children:t}),": ",(0,ye.EC)("%"===n?l.x/100:l.x,n)]}),(0,z.BX)(Y.Z,{children:[(0,z.tZ)("strong",{children:a}),": ",(0,ye.EC)("%"===i?l.y/100:l.y,i)]}),(0,z.tZ)(st.Z,{title:v?"":h("tcGraph.buildAlreadyInList"),placement:"top",children:(0,z.tZ)("span",{children:(0,z.tZ)(m.Z,{sx:{width:"100%"},disabled:!v,color:"info",onClick:()=>s(l.artifactIds),children:h("addBuildToList")})})})]})})})}):null}class ma{constructor(e,t,n){this.x=void 0,this.trueY=void 0,this.artifactIds=void 0,this.min=void 0,this.current=void 0,this.highlighted=void 0,this.x=e,this.trueY=t,this.artifactIds=n}get y(){return this.trueY||this.current||this.highlighted}set y(e){this.trueY=e}}let fa,ga,xa,ya,ba,va,Ca,wa=e=>e;function Ba({plotBase:e,setPlotBase:t,disabled:n=!1,showTooltip:a=!1}){const{t:i}=(0,g.$G)(["page_character_optimize","ui"]),{data:l}=(0,f.useContext)(X.R),{chartData:r}=(0,f.useContext)(K),[s,c]=(0,f.useState)(!1),[o,d]=(0,f.useState)(!0),{graphBuilds:u}=(0,f.useContext)(K),{database:h}=(0,f.useContext)(E.t),{character:{key:p}}=(0,f.useContext)(S.K),{buildResult:{builds:x}}=sa(p),[y,C]=(0,f.useState)(-1/0),[w,B]=(0,f.useState)(1/0),k=(0,f.useCallback)(((e,t)=>{if("number"==typeof t)throw new TypeError;const[n,a]=t;C(n),B(a)}),[C,B]);(0,f.useEffect)((()=>{C(-1/0),B(1/0)}),[r]);const{displayData:P,downloadData:O,sliderMin:j,sliderMax:D}=(0,f.useMemo)((()=>{var e,t;if(!r)return{displayData:null,downloadData:null};let n=1/0,a=-1/0;const i=(0,gt.Uq)(T.eV,(e=>{var t;return[e,null!=(t=null==l?void 0:l.get(xe.qH.art[e].id).value)?t:""]})),s=[...x,...null!=u?u:[]].map((e=>ja(e,h))),c=r.data.map((({value:e,plot:t,artifactIds:l})=>{if(void 0===t)return null;t<n&&(n=t),t>a&&(a=t);const r=new ma(t,e,l),c=ja(l,h);if(T.eV.every((e=>i[e]===c[e])))return r.current=e,r.y=void 0,r;return s.some((e=>T.eV.every((t=>e[t]===c[t]))))&&(r.highlighted=e,r.y=void 0),r})).sort(((e,t)=>e.x-t.x)),o=[];for(const l of c){let e;for(;e=o.pop();)if(e.y>l.y){o.push(e);break}o.push(l)}(null==(e=o[0])?void 0:e.x)!==(null==(t=c[0])?void 0:t.x)&&(c[0].min=o[0].y),o.forEach((e=>{e.min=e.y}));const d={minimum:o.map((e=>[e.x,e.y])),allData:c.map((e=>[e.x,e.y]))};return{displayData:c.filter((e=>e&&e.x>=y&&e.x<=w)),downloadData:d,sliderMin:n,sliderMax:a}}),[r,x,l,h,u,y,w]),I=e&&(0,gt.Hm)(null==l?void 0:l.getDisplay(),e),A=i(e&&(!I||I.isEmpty)?"page_character_optimize:targetSelector.invalidTarget":"page_character_optimize:targetSelector.selectGraphTarget");return(0,z.BX)(v.Z,{children:[(0,z.tZ)(Z.Z,{children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,alignItems:"center",children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(Y.Z,{children:i(fa||(fa=wa`tcGraph.vs`))})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(st.Z,{placement:"top",title:a?i("page_character_optimize:selectTargetFirst"):"",children:(0,z.tZ)("span",{children:(0,z.tZ)(ca.Z,{optimizationTarget:e,setTarget:e=>t(e),defaultText:A,disabled:n})})})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(st.Z,{title:e?i("ui:reset"):"",placement:"top",children:(0,z.tZ)("span",{children:(0,z.tZ)(m.Z,{color:"error",onClick:()=>t(void 0),disabled:!e,children:(0,z.tZ)(he.Z,{})})})})}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(Mt.Z,{placement:"top",title:i("page_character_optimize:tcGraph.desc")})}),!!O&&(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(m.Z,{size:"small",startIcon:o?(0,z.tZ)(pe.Z,{}):(0,z.tZ)(me.Z,{}),color:o?"success":"secondary",onClick:()=>d(!o),children:i(ga||(ga=wa`tcGraph.showStatThr`))})}),!!O&&(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(m.Z,{size:"small",color:"info",startIcon:(0,z.tZ)(Hn.Z,{}),onClick:()=>c(!s),children:i(xa||(xa=wa`tcGraph.downloadData`))})})]})}),P&&P.length&&(0,z.tZ)(F.Z,{}),r&&P&&P.length&&(0,z.BX)(Z.Z,{children:[(0,z.tZ)(ge.Z,{in:!!O&&s,children:(0,z.tZ)(b.Z,{sx:{mb:2},children:(0,z.BX)(Z.Z,{children:[(0,z.tZ)(Y.Z,{children:"Min Data"}),(0,z.tZ)(Sa,{data:null==O?void 0:O.minimum}),(0,z.tZ)(Y.Z,{children:"All Data"}),(0,z.tZ)(Sa,{data:null==O?void 0:O.allData})]})})}),(0,z.tZ)(Ea,{displayData:P,plotNode:r.plotNode,valueNode:r.valueNode,showMin:o}),P.length>1&&(0,z.tZ)(Un.ZP,{marks:!0,value:[y,w],onChange:k,onChangeCommitted:k,min:j,max:D,step:(D-j)/20,valueLabelDisplay:"auto",valueLabelFormat:e=>{var t,n;return(0,ye.EC)("%"===(null==(t=r.plotNode.info)?void 0:t.unit)?e/100:e,null==(n=r.plotNode.info)?void 0:n.unit)},sx:{ml:"6%",width:"93%"}})]})]})}const ka=(0,ve.ZP)("textarea")({width:"100%",fontFamily:"monospace",resize:"vertical",minHeight:"5em"});function Sa({data:e}){return(0,z.tZ)(ka,{readOnly:!0,value:JSON.stringify(e),onClick:e=>{const t=e.target;t.selectionStart=0,t.selectionEnd=t.value.length}})}const Xa="#8884d8",Pa="cyan",Ka="#46a046",Oa="#ff7300";function Ea({displayData:e,plotNode:t,valueNode:n,showMin:a}){var i,l,r,s;const{graphBuilds:c,setGraphBuilds:o}=(0,f.useContext)(K),{t:d}=(0,g.$G)("page_character_optimize"),[u,Z]=(0,f.useState)(),h=(0,f.useCallback)((e=>o([...null!=c?c:[],e])),[o,c]),p=(0,f.useCallback)((t=>{t&&t.chartX&&t.chartY&&Z(function(e,t,n,a){const i=Array.from(document.querySelectorAll(".custom-dot")).reduce(((n,a)=>{const{chartX:i,chartY:l}=n.dataset,r=Math.sqrt((e-i)**2+(t-l)**2),{chartX:s,chartY:c}=a.dataset;return r<=Math.sqrt((e-s)**2+(t-c)**2)?n:a})).dataset;return Math.sqrt((e-i.chartX)**2+(t-i.chartY)**2)<n?a.find((e=>e.x===+i.xValue&&e.y===+i.yValue)):void 0}(t.chartX,t.chartY,20,e))}),[Z,e]),m=Da(t,d),x=Da(n,d);return(0,z.tZ)(Yn.h,{width:"100%",height:600,children:(0,z.BX)(Jn.c,{id:"chartContainer",data:e,onClick:p,style:{cursor:"pointer"},children:[(0,z.tZ)(Qn.q,{strokeDasharray:"3 3"}),(0,z.tZ)(ea.K,{dataKey:"x",scale:"linear",unit:null==(i=t.info)?void 0:i.unit,domain:["auto","auto"],tick:{fill:"white"},type:"number",tickFormatter:e=>e>1e4?e.toFixed():e.toFixed(1),label:(0,z.tZ)(ta._,{fill:"white",dy:10,children:m}),height:50}),(0,z.tZ)(na.B,{name:"DMG",domain:["auto","auto"],unit:null==(l=n.info)?void 0:l.unit,allowDecimals:!1,tick:{fill:"white"},type:"number",label:(0,z.tZ)(ta._,{fill:"white",angle:-90,dx:-40,children:x}),width:100}),(0,z.tZ)(aa.u,{content:(0,z.tZ)(pa,{xLabel:m,xUnit:null==(r=t.info)?void 0:r.unit,yLabel:x,yUnit:null==(s=n.info)?void 0:s.unit,selectedPoint:u,setSelectedPoint:Z,addBuildToList:h}),trigger:"click",wrapperStyle:{pointerEvents:"auto",cursor:"auto"},cursor:!1}),(0,z.tZ)(ia.D,{payload:[...a?[{id:"min",value:d(ya||(ya=wa`tcGraph.statReqThr`)),type:"line",color:Oa}]:[],{id:"trueY",value:d(ba||(ba=wa`tcGraph.generatedBuilds`)),type:"circle",color:Xa},{id:"highlighted",value:d(va||(va=wa`tcGraph.highlightedBuilds`)),type:"square",color:Pa},{id:"current",value:d(Ca||(Ca=wa`tcGraph.currentBuild`)),type:"diamond",color:Ka}]}),a&&(0,z.tZ)(la.x,{dataKey:"min",stroke:Oa,type:"stepBefore",connectNulls:!0,strokeWidth:2,isAnimationActive:!1,dot:!1,activeDot:!1}),(0,z.tZ)(ra.b,{dataKey:"trueY",isAnimationActive:!1,shape:(0,z.tZ)(oa,{selectedPoint:u,colorUnselected:Xa})}),(0,z.tZ)(ra.b,{dataKey:"highlighted",isAnimationActive:!1,shape:(0,z.tZ)(oa,{shape:"square",selectedPoint:u,colorUnselected:Pa})}),(0,z.tZ)(ra.b,{dataKey:"current",isAnimationActive:!1,shape:(0,z.tZ)(oa,{shape:"diamond",selectedPoint:u,colorUnselected:Ka})})]})})}function ja(e,t){const n=Object.fromEntries(e.map((e=>{const n=t.arts.get(e);return n?[n.slotKey,n.id]:[]})));return(0,gt.Uq)(T.eV,(e=>{var t;return[e,null!=(t=n[e])?t:""]}))}function Da(e,t){var n,a,i,l,r,s,c;return"string"==typeof(null==(n=e.info)?void 0:n.name)?e.info.name:`${t(`${null==(a=e.info)||null==(i=a.name)?void 0:i.props.ns}:${null==(l=e.info)||null==(r=l.name)?void 0:r.props.key18}`)}${null!=(s=e.info)&&s.textSuffix?` ${null==(c=e.info)?void 0:c.textSuffix}`:""}`}var Ia=n(10618),Aa=n(40775);const Ra=["sands","goblet","circlet"];function Ga({disabled:e=!1,filteredArtIds:t}){const{t:n}=(0,g.$G)("artifact"),{character:{key:a}}=(0,f.useContext)(S.K),{buildSetting:{mainStatKeys:i},buildSettingDispatch:l}=Nt(a),{database:r}=(0,f.useContext)(E.t),s=(0,f.useMemo)((()=>(0,gt.O)(T.eV,(e=>(0,Aa.W)(Sn.ZP.slotMainStats(e),(n=>Object.entries(r.arts.data).forEach((([a,i])=>{if(i.slotKey!==e)return;const l=i.mainStatKey;l&&n[l]&&(n[l].total++,t.includes(a)&&n[l].current++)}))))))),[t,r]),c=(0,f.useMemo)((()=>(0,Aa.W)(Ra,(e=>Object.entries(r.arts.data).forEach((([n,a])=>{const i=a.slotKey;e[i]&&(e[i].total++,t.includes(n)&&e[i].current++)}))))),[t,r]);return(0,z.BX)(d.Z,{display:"flex",flexDirection:"column",children:[(0,z.tZ)(F.Z,{}),(0,z.BX)(d.Z,{display:"flex",children:[(0,z.tZ)(Z.Z,{sx:{flexGrow:1},children:(0,z.BX)(d.Z,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,z.tZ)(st.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:n("slotName.flower")}),children:(0,z.tZ)("span",{children:(0,Gt.Ir)("flower")})}),(0,z.tZ)(d.Z,{flexGrow:1,children:(0,z.BX)(k.Z,{color:"info",children:[ke.Z.hp," ",s.flower.hp]})})]})}),(0,z.tZ)(F.Z,{orientation:"vertical",flexItem:!0}),(0,z.tZ)(Z.Z,{sx:{flexGrow:1},children:(0,z.BX)(d.Z,{sx:{display:"flex",gap:1,alignItems:"center"},children:[(0,z.tZ)(st.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:n("slotName.plume")}),children:(0,z.tZ)("span",{children:(0,Gt.Ir)("plume")})}),(0,z.tZ)(d.Z,{flexGrow:1,children:(0,z.BX)(k.Z,{color:"info",children:[ke.Z.atk," ",s.plume.atk]})})]})})]}),Ra.map((t=>{const a=i[t],r=Sn.ZP.slotMainStats(t),o=(0,Ia.X)([...r]);return(0,z.BX)(d.Z,{children:[(0,z.tZ)(F.Z,{}),(0,z.BX)(Z.Z,{sx:{pt:1,pb:1},children:[(0,z.BX)(d.Z,{sx:{display:"flex",gap:1,alignItems:"center",pb:1},children:[(0,z.tZ)(st.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:n(`slotName.${t}`)}),children:(0,z.tZ)("span",{children:(0,Gt.Ir)(t)})}),(0,z.tZ)(d.Z,{flexGrow:1,children:(0,z.tZ)(k.Z,{color:"info",children:c[t]})})]}),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,children:r.map(((n,r)=>{const c=T.Kj.find((e=>n.includes(e))),d=a.includes(n)?null!=c?c:"success":"secondary";return(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,xs:r<3&&"goblet"!==t?4:void 0,children:(0,z.tZ)(st.Z,{placement:"top",title:(0,z.tZ)(Y.Z,{children:(0,z.tZ)("strong",{children:(0,z.tZ)(Kn._,{statKey:n})})}),disableInteractive:!0,children:(0,z.BX)(m.Z,{fullWidth:!0,size:"small",color:d,sx:{height:"100%",pointerEvents:e?"none":void 0,cursor:e?"none":void 0,display:"flex",gap:.5},onClick:()=>l({mainStatKeys:Object.assign({},i,{[t]:o(a,n)})}),children:[ke.Z[n]," ",s[t][n]]})})},n)}))})]})]},t)}))]})}function Ma({statFilters:e,setStatFilters:t,disabled:n=!1}){const a=(0,f.useCallback)(((n,a,i)=>{var l;const r=Object.assign({},e),s=JSON.stringify(a),c=a?[...e[s]]:void 0,o=JSON.stringify(n),d=[...null!=(l=e[o])?l:[]];void 0!==i&&c?d.push(c[i]):d.push({value:0,disabled:!1}),r[o]=d,void 0!==i&&c&&(c.splice(i,1),c.length?r[s]=c:delete r[s]),t(Object.assign({},r))}),[t,e]),i=(0,f.useCallback)(((n,a)=>{const i=Object.assign({},e),l=JSON.stringify(n),r=[...e[l]];r.splice(a,1),r.length?i[l]=r:delete i[l],t(Object.assign({},i))}),[t,e]),l=(0,f.useCallback)(((n,a,i)=>{const l=Object.assign({},e),r=JSON.stringify(n),s=[...e[r]];s[a]=Object.assign({},s[a],{value:i}),l[r]=s,t(Object.assign({},l))}),[t,e]),r=(0,f.useCallback)(((n,a,i)=>{const l=Object.assign({},e),r=JSON.stringify(n),s=[...e[r]];s[a]=Object.assign({},s[a],{disabled:i}),l[r]=s,t(Object.assign({},l))}),[t,e]);return(0,z.BX)(z.HY,{children:[Object.entries(e).flatMap((([e,t])=>null==t?void 0:t.map(((t,s)=>(0,z.tZ)(Ta,{path:JSON.parse(e),setting:t,index:s,setTarget:a,delTarget:i,setValue:l,setDisabled:r,disabled:n},e+s))))),(0,z.tZ)(Ta,{setTarget:a,delTarget:i,setValue:l,setDisabled:r,disabled:n})]})}function Ta({path:e,setting:t,index:n,setTarget:a,delTarget:i,setValue:l,setDisabled:r,disabled:s}){var c;const{t:o}=(0,g.$G)("page_character_optimize"),{data:d}=(0,f.useContext)(X.R),u=(0,f.useCallback)((t=>e&&void 0!==n&&l(e,n,null!=t?t:0)),[l,e,n]),Z={p:1,flexBasis:30,flexGrow:0,flexShrink:0},h=(0,gt.Hm)(d.getDisplay(),null!=e?e:[]),p="%"===(null==h||null==(c=h.info)?void 0:c.unit);return(0,z.BX)(Se.Z,{sx:{"& .MuiButtonGroup-grouped":{minWidth:24},width:"100%"},children:[!!t&&!!e&&void 0!==n&&(0,z.tZ)(m.Z,{sx:Z,color:t.disabled?"secondary":"success",onClick:()=>r(e,n,!t.disabled),disabled:s,children:t.disabled?(0,z.tZ)(me.Z,{}):(0,z.tZ)(pe.Z,{})}),(0,z.tZ)(ca.Z,{showEmptyTargets:!0,optimizationTarget:e,setTarget:t=>a(t,e,n),defaultText:o("targetSelector.selectBuildTarget")}),(0,z.tZ)(Xe.CC,{sx:{flexBasis:150,flexGrow:1},children:(0,z.tZ)(Xe.ZP,{float:!0,disabled:!e||s,value:null==t?void 0:t.value,placeholder:"Stat Value",onChange:u,sx:{px:1},inputProps:{sx:{textAlign:"right"}},endAdornment:p?"%":void 0})}),!!e&&void 0!==n&&(0,z.tZ)(m.Z,{sx:Z,color:"error",onClick:()=>i(e,n),disabled:s,children:(0,z.tZ)(tt.Z,{fontSize:"small"})})]})}let _a,Va,Na=e=>e;function za({disabled:e=!1}){const{t}=(0,g.$G)("page_character_optimize"),{character:{key:n}}=(0,f.useContext)(S.K),{buildSetting:{statFilters:a},buildSettingDispatch:i}=Nt(n),l=(0,f.useCallback)((e=>i({statFilters:e})),[i]);return(0,z.BX)(d.Z,{children:[(0,z.tZ)(v.Z,{children:(0,z.BX)(Z.Z,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:[(0,z.tZ)(Y.Z,{children:t(_a||(_a=Na`constraintFilter.title`))}),(0,z.tZ)(Mt.Z,{title:(0,z.tZ)(Y.Z,{children:t(Va||(Va=Na`constraintFilter.tooltip`))})})]})}),(0,z.tZ)(d.Z,{display:"flex",flexDirection:"column",gap:.5,children:(0,z.tZ)(Ma,{statFilters:a,setStatFilters:l,disabled:e})})]})}var La=n(23677),qa=n(92315),$a=n(2142),Wa=n(91748),Fa=n(92252),Ha=n(51704),Ua=n(32240);let Ya,Ja=e=>e;const Qa=f.lazy((()=>Promise.all([n.e(592),n.e(26)]).then(n.bind(n,1296))));function ei({disabled:e=!1,filteredArts:t}){const{t:n}=(0,g.$G)("page_character_optimize"),{character:{key:a}}=(0,f.useContext)(S.K),{buildSetting:{useEquippedArts:i},buildSettingDispatch:l}=Nt(a),{database:r}=(0,f.useContext)(E.t),[s,c,o]=(0,j.Z)(!1),[{equipmentPriority:u},h]=(0,f.useState)(r.displayOptimize.get());(0,f.useEffect)((()=>r.displayOptimize.follow(((e,t)=>h(t)))),[r,h]);const p=(0,f.useMemo)((()=>[...new Set(u)].filter((e=>r.chars.get(e)))),[r,u]),x=(0,f.useCallback)((e=>r.displayOptimize.set({equipmentPriority:e})),[r]),y=(0,f.useCallback)(((e,t)=>{const n=[...p],a=n[e];n.splice(e,1),n.splice(t,0,a),x(n)}),[p,x]),w=(0,f.useCallback)((e=>{const t=[...p];t.splice(e,1),x(t)}),[p,x]),B=(0,f.useCallback)((e=>x([...p,e])),[p,x]),X=(0,f.useCallback)((()=>x([])),[x]),P=(0,f.useMemo)((()=>{let e=p.length;const t=p.indexOf(a);return t>=0&&(e=t),e}),[a,p]),K=(0,f.useMemo)((()=>r.chars.keys.length-1-P),[P,r]),O=(0,f.useMemo)((()=>r.chars.keys.length-p.length),[p,r]),D=(0,f.useMemo)((()=>t.filter((e=>e.location&&e.location!==(0,T.V7)(a))).length),[t,a]);return(0,z.BX)(d.Z,{display:"flex",gap:1,children:[(0,z.tZ)(ae.Z,{open:s,onClose:o,containerProps:{maxWidth:"sm"},children:(0,z.BX)(b.Z,{children:[(0,z.tZ)(Z.Z,{children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(Y.Z,{variant:"h6",children:n(Ya||(Ya=Ja`useEquipped.modal.title`))})}),(0,z.tZ)(ue.ZP,{item:!0,sx:{mb:-1},children:(0,z.tZ)(C.Z,{onClick:o})})]})}),(0,z.tZ)(F.Z,{}),(0,z.BX)(Z.Z,{children:[(0,z.tZ)(v.Z,{sx:{mb:1},children:(0,z.BX)(Z.Z,{children:[(0,z.tZ)(Y.Z,{gutterBottom:!0,children:(0,z.tZ)(g.cC,{t:n,i18nKey:"useEquipped.modal.desc1",children:"When generating a build, the Optimizer will only consider equipped artifacts from characters below the current character or those not on the list."})}),(0,z.tZ)(Y.Z,{gutterBottom:!0,children:(0,z.tZ)(g.cC,{t:n,i18nKey:"useEquipped.modal.desc2",children:"If the current character is not on the list, the Optimizer will only consider equipped artifacts from others characters that are not on the list."})})]})}),(0,z.BX)(d.Z,{display:"flex",flexDirection:"column",gap:2,children:[p.map(((e,t)=>(0,z.tZ)(ti,{characterKey:e,rank:t+1,maxRank:p.length,setRank:e=>e&&y(t,e-1),onRemove:()=>w(t),numAbove:P},e))),(0,z.BX)(d.Z,{sx:{display:"flex",gap:1},children:[(0,z.tZ)(ni,{onAdd:B,list:p}),(0,z.tZ)(m.Z,{color:"error",onClick:X,startIcon:(0,z.tZ)(he.Z,{}),children:(0,z.tZ)(g.cC,{t:n,i18nKey:"useEquipped.modal.clearList",children:"Clear List"})})]}),!!K&&(0,z.tZ)(k.Z,{color:"success",children:(0,z.tZ)(Y.Z,{children:(0,z.BX)(g.cC,{t:n,i18nKey:"useEquipped.modal.usingNum",count:O,children:["Using artifacts from ",(0,z.tZ)("strong",{children:{count:O}})," unlisted characters"]})})})]})]})]})}),(0,z.BX)(Se.Z,{sx:{display:"flex",width:"100%"},children:[(0,z.tZ)(m.Z,{sx:{flexGrow:1},onClick:()=>l({useEquippedArts:!i}),disabled:e,startIcon:i?(0,z.tZ)(pe.Z,{}):(0,z.tZ)(me.Z,{}),color:i?"success":"secondary",children:(0,z.BX)(d.Z,{sx:{display:"flex",gap:1},children:[(0,z.tZ)("span",{children:(0,z.tZ)(g.cC,{t:n,i18nKey:"useEquipped.title",children:"Use Equipped Artifacts"})}),i&&(0,z.tZ)(k.Z,{children:(0,z.BX)(g.cC,{t:n,i18nKey:"useEquipped.usingNumTot",count:O,arts:D,children:["Using ",(0,z.tZ)("strong",{children:{arts:D}})," artifacts from ",(0,z.tZ)("strong",{children:{count:O}})," characters"]})})]})}),i&&(0,z.tZ)(m.Z,{sx:{flexShrink:1},color:"info",onClick:c,disabled:e,children:(0,z.tZ)(Dt.Z,{})})]})]})}function ti({characterKey:e,rank:t,maxRank:n,setRank:a,onRemove:i,numAbove:l}){const{t:r}=(0,g.$G)("page_character_optimize"),{database:s}=(0,f.useContext)(E.t),c=(0,D.Z)(e),o=(0,N.Z)();if(!c)return null;const{equippedWeapon:u,equippedArtifacts:Z}=c;return(0,z.BX)(v.Z,{sx:{p:1},children:[(0,z.BX)(d.Z,{sx:{pb:1,display:"flex",justifyContent:"space-between",gap:1},children:[(0,z.tZ)(k.Z,{color:"info",children:(0,z.BX)(Y.Z,{children:["#",t]})}),(0,z.tZ)(k.Z,{sx:{flexGrow:1},color:l===t-1?"warning":t-1<l?"error":"success",children:(0,z.tZ)(Y.Z,{children:l===t-1?(0,z.tZ)(g.cC,{t:r,i18nKey:"useEquipped.modal.status.curr",children:"Current character"}):t-1<l?(0,z.tZ)(g.cC,{t:r,i18nKey:"useEquipped.modal.status.dont",children:"Don't Use artifacts"}):(0,z.tZ)(g.cC,{t:r,i18nKey:"useEquipped.modal.status.use",children:"Use artifacts"})})}),(0,z.tZ)(d.Z,{children:(0,z.BX)(Se.Z,{sx:{flexGrow:1},size:"small",children:[(0,z.tZ)(Xe.CC,{children:(0,z.tZ)(Xe.ZP,{onChange:a,value:t,inputProps:{min:1,max:n,sx:{textAlign:"center"}},sx:{width:"100%",height:"100%",pl:2}})}),(0,z.tZ)(m.Z,{disabled:1===t,onClick:()=>a(1),children:(0,z.tZ)(La.Z,{})}),(0,z.tZ)(m.Z,{disabled:1===t,onClick:()=>a(t-1),children:(0,z.tZ)(qa.Z,{})}),(0,z.tZ)(m.Z,{disabled:t===n,onClick:()=>a(t+1),children:(0,z.tZ)($a.Z,{})}),(0,z.tZ)(m.Z,{disabled:t===n,onClick:()=>a(n),children:(0,z.tZ)(Wa.Z,{})}),(0,z.tZ)(m.Z,{color:"error",onClick:i,children:(0,z.tZ)(et.Z,{})})]})})]}),(0,z.BX)(ue.ZP,{container:!0,columns:7,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Ha.Z,{characterKey:e,onClick:o})}),(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Ua.Z,{weaponId:u})}),Object.entries(Z).map((([e,t])=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(Za.Z,{slotKey:e,artifactObj:s.arts.get(t)})},e)))]})]})}function ni({onAdd:e,list:t}){const{t:n}=(0,g.$G)("page_character_optimize"),[a,i,l]=(0,j.Z)(!1),r=(0,f.useCallback)((e=>!!e&&!t.includes(e.key)),[t]);return(0,z.BX)(z.HY,{children:[(0,z.tZ)(f.Suspense,{fallback:!1,children:(0,z.tZ)(Qa,{show:a,onHide:l,onSelect:e,filter:r})}),(0,z.tZ)(m.Z,{fullWidth:!0,sx:{height:60},color:"info",onClick:i,startIcon:(0,z.tZ)(Fa.Z,{}),children:(0,z.tZ)(g.cC,{t:n,i18nKey:"useEquipped.modal.add",children:"Add character to list"})})]})}function ai({disabled:e=!1,artsDirty:t}){const{t:n}=(0,g.$G)("page_character_optimize"),{character:{key:a}}=(0,f.useContext)(S.K),{buildSetting:{useExcludedArts:i},buildSettingDispatch:l}=Nt(a),{database:r}=(0,f.useContext)(E.t),s=(0,f.useMemo)((()=>t&&r.arts.values.reduce(((e,t)=>e+(t.exclude?1:0)),0)),[r,t,a]);return(0,z.tZ)(m.Z,{fullWidth:!0,onClick:()=>l({useExcludedArts:!i}),disabled:!s||e,startIcon:i?(0,z.tZ)(pe.Z,{}):(0,z.tZ)(me.Z,{}),color:i?"success":"secondary",children:(0,z.BX)(d.Z,{sx:{display:"flex",gap:1},children:[(0,z.tZ)(d.Z,{children:(0,z.tZ)(g.cC,{t:n,i18nKey:"useExcluded.title",count:s,children:"Use Excluded Artifacts"})}),i?(0,z.tZ)(k.Z,{children:(0,z.BX)(g.cC,{t:n,i18nKey:"useExcluded.usingNum",count:s,children:["Using ",(0,z.tZ)("strong",{children:{count:s}})," excluded artifacts"]})}):(0,z.tZ)(k.Z,{color:"error",children:(0,z.BX)(g.cC,{t:n,i18nKey:"useExcluded.excNum",count:s,children:["Excluded ",(0,z.tZ)("strong",{children:{count:s}})," artifacts"]})})]})})}let ii,li=e=>e;function ri(){const{t:e}=(0,g.$G)("page_character_optimize");return(0,z.tZ)(nt.Z,{severity:"error",variant:"filled",onClick:()=>window.location.reload(),sx:{"& .MuiAlert-message":{flexGrow:1,cursor:"pointer"}},children:e(ii||(ii=li`workerLoadFailed`))})}var si=n(69190);const ci=(0,bt.yY)((0,gt.I8)({dyn:Object.assign({},xe.qH.art,xe.qH.artSet)})),oi={art:(0,gt.O)([...si.r,...si._],(e=>ci.dyn[e])),artSet:(0,gt.xh)(xe.qH.artSet,((e,t)=>ci.dyn[t]))};let di,ui,Zi,hi,pi=e=>e;function mi(){var e,t;const{t:a}=(0,g.$G)("page_character_optimize"),{character:{key:i,compareData:l}}=(0,f.useContext)(S.K),{database:s}=(0,f.useContext)(E.t),{setChartData:c,graphBuilds:o,setGraphBuilds:u}=(0,f.useContext)(K),[h,p]=(0,f.useState)({type:"inactive",tested:0,failed:0,skipped:0,total:0}),x="inactive"!==h.type,[b,C]=(0,mt.Z)(),[{equipmentPriority:B,threads:P=Zt.g},O]=(0,f.useState)(s.displayOptimize.get());(0,f.useEffect)((()=>s.displayOptimize.follow(((e,t)=>O(t)))),[s,O]);const j=P>Zt.g?Zt.g:P,D=(0,f.useCallback)((e=>s.displayOptimize.set({threads:e})),[s]),A=(0,I.Z)(i),R=(0,N.Z)();(0,f.useEffect)((()=>{p({type:"inactive",tested:0,failed:0,skipped:0,total:0})}),[i]);const M=(0,f.useMemo)((()=>!s.arts.values.length),[s]),{buildSetting:_,buildSettingDispatch:V}=Nt(i),{plotBase:L,optimizationTarget:q,mainStatAssumptionLevel:$,allowPartial:W,maxBuildsToShow:H,levelLow:U,levelHigh:J}=_,{buildResult:{builds:Q,buildDate:ee},buildResultDispatch:te}=sa(i),ne=(0,G.Z)(i,$),{characterSheet:ae,target:ie}=null!=(e=null==ne?void 0:ne[i])?e:{},le=q&&(0,gt.Hm)(null==ie?void 0:ie.getDisplay(),q),re=["xs","sm"].includes((0,ft.Z)());(0,f.useEffect)((()=>s.arts.followAny(C)),[C,s]);const se=(0,f.useDeferredValue)(b),ce=(0,f.useDeferredValue)(_),oe=(0,f.useMemo)((()=>{const{mainStatKeys:e,useExcludedArts:t,useEquippedArts:n,levelLow:a,levelHigh:l}=se&&ce,r=new Set;if(n){const e=B.indexOf(i);e<0?B.forEach((e=>r.add((0,T.V7)(e)))):B.slice(0,e).forEach((e=>r.add((0,T.V7)(e))))}return s.arts.values.filter((s=>{if(s.level<a)return!1;if(s.level>l)return!1;const c=e[s.slotKey];return!(null!=c&&c.length&&!c.includes(s.mainStatKey))&&(!(s.exclude&&!t)&&(s.location===(0,T.V7)(i)||!(s.location&&!n)&&!(s.location&&n&&r.has(s.location))))}))}),[s,i,B,se,ce]),de=(0,f.useMemo)((()=>oe.map((e=>e.id))),[oe]),Ze=(0,f.useMemo)((()=>{const{levelLow:e,levelHigh:t}=ce;let n=0,a=0;return Object.entries(s.arts.data).forEach((([i,l])=>{l.level>=e&&l.level<=t&&(n++,de.includes(i)&&a++)})),`${a}/${n}`}),[ce,de,s]),he=(0,f.useRef)((()=>{}));(0,f.useEffect)((()=>()=>he.current()),[]);const[fe,ge]=(0,f.useState)(!1),xe=(0,f.useCallback)((async()=>{var e,t,a;const{artSetExclusion:l,plotBase:r,statFilters:o,optimizationTarget:d,mainStatAssumptionLevel:u,allowPartial:Z,maxBuildsToShow:h}=_;if(!i||!d)return;const m=function(e,t,n){const a={base:{},values:{flower:[],plume:[],goblet:[],circlet:[],sands:[]}},i=new Set;for(const l of e){const e=Sn.ZP.mainStatValue(l.mainStatKey,l.rarity,Math.max(Math.min(t,4*l.rarity),l.level)),n={id:l.id,set:l.setKey,values:Object.assign({[l.setKey]:1,[l.mainStatKey]:l.mainStatKey.endsWith("_")?e/100:e},Object.fromEntries(l.substats.map((e=>[e.key,e.key.endsWith("_")?e.accurateValue/100:e.accurateValue]))))};delete n.values[""],a.values[l.slotKey].push(n),Object.keys(n.values).forEach((e=>i.add(e)))}if(a.base=(0,gt.O)([...i],(e=>0)),n)for(const l of Object.values(a.values))l.push({id:"",values:{}});return a}(oe,u,Z),f=await(0,G.V)(s,i,u,[]);if(!f)return;const g=null==(e=(0,ht.Qo)(f.teamData,i)[i])?void 0:e.target.data[0];if(!g)return;Object.assign(g,(0,ht.b3)([g,oi]));const x=(0,gt.Hm)(null!=(t=g.display)?t:{},d);if(!x)return;const y=x,b=Object.entries(o).flatMap((([e,t])=>t.filter((e=>!e.disabled)).map((t=>{var n,a;const i=(0,gt.Hm)(null!=(n=g.display)?n:{},JSON.parse(e));return{value:i,minimum:"%"===(null==(a=i.info)?void 0:a.unit)?t.value/100:t.value}})))).filter((e=>e.value&&e.minimum>-1/0));c(void 0);const v=new Promise((e=>he.current=e)),C=[...b.map((e=>e.value)),x];let w=m;const B=function*(e,t){const n=(0,gt.xh)(t.values,(e=>new Set(e.map((e=>e.set)))));e:for(const a of e){for(const[e,t]of Object.entries(a)){const a=n[e];switch(t.kind){case"required":if([...t.sets].every((e=>!a.has(e))))continue e;break;case"exclude":if([...a].every((e=>t.sets.has(e))))continue e}}yield a}}(Ot(l,Object.values(m.values).flatMap((e=>e.map((e=>e.set))))),m),k=[...b.map((e=>e.minimum)),-1/0],S={tested:0,failed:0,skipped:0,total:NaN,startTime:performance.now()},X=r&&(0,gt.Hm)(null!=(a=g.display)?a:{},r);X&&(C.push(X),k.push(-1/0));const P=w;let K=(0,pt.tL)(C,g,(({path:[e]})=>"dyn"!==e));K=function(e,t){const n={};for(const[a,i]of Object.entries(t))i.includes(4)&&(n[a]=i.includes(2)?1:3);return(0,yt.uW)(e,(e=>e),(e=>{if("threshold"!==e.operation)return e;const[a,i,l,r]=e.operands;if("read"===a.operation&&"const"===i.operation){const e=a.path[a.path.length-1],s=i.value;if(e in n){if(n[e]<s)return r;if(2===s&&t[e].includes(2))return(0,bt.Lj)(a,4,l,r)}}return e}))}(K,l),({nodes:K,arts:w}=function(e,t,n,a,i,l){let r=l;const s={pruneNodeRange:!0},c={pruneNodeRange:!0},o={reaffine:!0},d={pruneOrder:!0,pruneArtRange:!0,pruneNodeRange:!0};let u=0;for(;Object.values(r).some((e=>e))&&u++<20;){if(r.pruneOrder){delete r.pruneOrder;const e=Ct(n,a,i);n!==e&&(n=e,r=Object.assign({},r,s))}if(r.pruneArtRange){delete r.pruneArtRange;const a=wt(e,n,t);n!==a&&(n=a,r=Object.assign({},r,c))}if(r.pruneNodeRange){delete r.pruneNodeRange;const t=Bt(e,n);e!==t&&(e=t,r=Object.assign({},r,o))}if(r.reaffine){delete r.reaffine;const{nodes:t,arts:a}=vt(e,n);e===t&&n===a||(e=t,n=a,r=Object.assign({},r,d))}}return{nodes:e,arts:n}}(K,k,w,h,l,{reaffine:!0,pruneArtRange:!0,pruneNodeRange:!0,pruneOrder:!0})),K=(0,pt.tL)(K,{},(e=>!1));const O=X?K.pop():void 0,E=K.pop(),D={buildValues:Array(h).fill(0).map((e=>({src:"",val:-1/0})))},I=16e6,A=16*j,R=B[Symbol.iterator](),M=[],T=[],V=new Set,N=[];function z(){return D.buildValues[h-1].val}function L(){const{done:e,value:t}=R.next();return e?void 0:{command:"split",minCount:I,threshold:z(),filter:t}}function q(){const e=M.pop();return e?{command:"iterate",threshold:z(),filter:e}:void 0}const $=K.map(((e,t)=>({value:e,min:k[t]}))).filter((e=>e.min>-1/0)),W=[];for(let i=0;i<j;i++){const e=new Worker(new URL(n.p+n.u(431),n.b));e.addEventListener("error",(e=>{console.error("Failed to load worker"),ge(!0),he.current()}));const t={command:"setup",id:i,arts:w,optimizationTarget:E,plotBase:O,maxBuilds:h,filters:$};if(e.postMessage(t,void 0),0===i){const t={command:"count",exclusion:l,arts:[w,P]};e.postMessage(t,void 0)}let a;const r=new Promise((e=>a=e));e.onmessage=async({data:t})=>{switch(ge(!1),t.command){case"interim":S.tested+=t.tested,S.failed+=t.failed,S.skipped+=t.skipped,t.buildValues&&(D.buildValues=D.buildValues.filter((({src:e})=>e!==t.source)),D.buildValues.push(...t.buildValues.map((e=>({src:t.source,val:e})))),D.buildValues.sort(((e,t)=>t.val-e.val)).splice(h));break;case"split":t.filter?(M.push(t.filter),V.add(t.id)):V.delete(t.id),T.push(t.id);break;case"iterate":T.push(t.id);break;case"finalize":return e.terminate(),void a(t);case"count":const[n,i]=t.counts;return S.total=i,void(S.skipped+=i-n);default:console.log("DEBUG",t)}for(;T.length;){const e=T.pop(),t=N[e];let n;if(M.length<A&&(n=L(),!n&&V.has(e)&&(n={command:"split",filter:void 0,minCount:I,threshold:z()})),n||(n=q()),!n){if(T.push(e),T.length===4*j){const e={command:"finalize"};N.forEach((t=>t.postMessage(e)))}break}t.postMessage(n)}},N.push(e),v.then((()=>e.terminate())),W.push(r)}for(let n=0;n<3;n++)T.push(...(0,gt.w6)(0,j-1));const F=setInterval((()=>p(Object.assign({type:"active"},S))),100),H=await Promise.any([Promise.all(W),v]);if(clearInterval(F),he.current=()=>{},H){if(X){var U,Y;const e=function(e){let t=.01,n=new Set(e.flatMap((e=>Object.values(e).map((e=>Math.round(e.plot/t))))));for(;n.size>1500;)t*=2,n=new Set([...n].map((e=>Math.round(e/2))));const a={};for(const i of e)for(const e of Object.values(i)){const n=Math.round(e.plot/t)*t;(!a[n]||a[n].value<e.value)&&(a[n]=e)}return a}(H.map((e=>e.plotData)));let t=Object.values(e);"%"===(null==(U=y.info)?void 0:U.unit)&&(t=t.map((({value:e,plot:t,artifactIds:n})=>({value:100*e,plot:t,artifactIds:n})))),"%"===(null==(Y=X.info)?void 0:Y.unit)&&(t=t.map((({value:e,plot:t,artifactIds:n})=>({value:e,plot:100*(null!=t?t:0),artifactIds:n})))),c({valueNode:y,plotNode:X,data:t})}const e=function(e,t){return e.flatMap((e=>e)).sort(((e,t)=>t.value-e.value)).slice(0,t)}(H.map((e=>e.builds)),h);0,te({builds:e.map((e=>e.artifactIds)),buildDate:Date.now()})}else S.tested=0,S.failed=0,S.skipped=0,S.total=0;p(Object.assign({},S,{type:"inactive",finishTime:performance.now()}))}),[i,oe,s,te,j,_,c]),ye=null!=(t=null==ae?void 0:ae.name)?t:"Character Name",be=(0,f.useCallback)((e=>{V({plotBase:e}),c(void 0)}),[V,c]),ve=(0,f.useMemo)((()=>ie&&ne&&{data:ie,teamData:ne}),[ie,ne]),Ce=(0,z.tZ)(ca.Z,{optimizationTarget:q,setTarget:e=>V({optimizationTarget:e}),disabled:!!x}),we=(0,f.useCallback)((e=>(0,z.BX)(g.cC,{t:a,i18nKey:"graphBuildLabel",count:e+1,children:["Graph #",{count:e+1}]})),[a]),Be=(0,f.useCallback)((e=>`#${e+1}`),[]);return(0,z.BX)(d.Z,{display:"flex",flexDirection:"column",gap:1,children:[M&&(0,z.tZ)(nt.Z,{severity:"warning",variant:"filled",children:(0,z.BX)(g.cC,{t:a,i18nKey:"noArtis",children:["Oops! It looks like you haven't added any artifacts to GO yet! You should go to the ",(0,z.tZ)(at.Z,{component:y.rU,to:"/artifacts",children:"Artifacts"})," page and add some!"]})}),ve&&(0,z.BX)(X.R.Provider,{value:ve,children:[(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:12,sm:6,lg:3,display:"flex",flexDirection:"column",gap:1,children:(0,z.tZ)(d.Z,{children:(0,z.tZ)(ct.Z,{characterKey:i,onClickTeammate:R})})}),(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:6,lg:3,display:"flex",flexDirection:"column",gap:1,children:[(0,z.BX)(v.Z,{children:[(0,z.tZ)(Z.Z,{children:(0,z.tZ)(st.Z,{placement:"top",title:(0,z.BX)(d.Z,{children:[(0,z.tZ)(Y.Z,{variant:"h6",children:a(di||(di=pi`mainStat.levelAssTooltip.title`))}),(0,z.tZ)(Y.Z,{children:a(ui||(ui=pi`mainStat.levelAssTooltip.desc`))})]}),children:(0,z.tZ)(d.Z,{children:(0,z.tZ)(Zn,{mainStatAssumptionLevel:$,setmainStatAssumptionLevel:e=>V({mainStatAssumptionLevel:e}),disabled:x})})})}),(0,z.tZ)(Ga,{disabled:x,filteredArtIds:de})]}),(0,z.tZ)(hn,{})]}),(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:6,lg:6,display:"flex",flexDirection:"column",gap:1,children:[(0,z.tZ)(sn,{disabled:x}),(0,z.tZ)(ai,{disabled:x,artsDirty:b}),(0,z.tZ)(ei,{disabled:x,filteredArts:oe}),(0,z.tZ)(m.Z,{fullWidth:!0,startIcon:W?(0,z.tZ)(pe.Z,{}):(0,z.tZ)(me.Z,{}),color:W?"success":"secondary",onClick:()=>V({allowPartial:!W}),disabled:x,children:a(Zi||(Zi=pi`allowPartial`))}),(0,z.BX)(v.Z,{children:[(0,z.BX)(Z.Z,{children:[a(hi||(hi=pi`levelFilter`))," ",(0,z.tZ)(k.Z,{color:"info",children:Ze})]}),(0,z.tZ)(rt.Z,{levelLow:U,levelHigh:J,setLow:e=>V({levelLow:e}),setHigh:e=>V({levelHigh:e}),setBoth:(e,t)=>V({levelLow:e,levelHigh:t}),disabled:x})]}),(0,z.tZ)(za,{disabled:x})]})]}),re&&Ce,(0,z.BX)(Se.Z,{children:[!re&&Ce,(0,z.BX)(ot.Z,{disabled:x||!i,title:(0,z.BX)(g.cC,{t:a,i18nKey:"build",count:H,children:[{count:H}," Builds"]}),children:[(0,z.tZ)(it.Z,{children:(0,z.tZ)(Y.Z,{variant:"caption",color:"info.main",children:a("buildDropdownDesc")})}),(0,z.tZ)(F.Z,{}),xt.s.map((e=>(0,z.tZ)(it.Z,{onClick:()=>V({maxBuildsToShow:e}),children:(0,z.BX)(g.cC,{t:a,i18nKey:"build",count:e,children:[{count:e}," Builds"]})},e)))]}),(0,z.BX)(ot.Z,{disabled:x||!i,sx:{borderRadius:"4px 0px 0px 4px"},title:(0,z.BX)(g.cC,{t:a,i18nKey:"thread",count:j,children:[{count:j}," Threads"]}),children:[(0,z.tZ)(it.Z,{children:(0,z.tZ)(Y.Z,{variant:"caption",color:"info.main",children:a("threadDropdownDesc")})}),(0,z.tZ)(F.Z,{}),(0,gt.w6)(1,Zt.g).reverse().map((e=>(0,z.tZ)(it.Z,{onClick:()=>D(e),children:(0,z.BX)(g.cC,{t:a,i18nKey:"thread",count:e,children:[{count:e}," Threads"]})},e)))]}),(0,z.tZ)(st.Z,{placement:"top",title:q?"":a("selectTargetFirst"),children:(0,z.tZ)("span",{children:(0,z.tZ)(m.Z,{disabled:!i||!q||!le||le.isEmpty,color:x?"error":"success",onClick:x?()=>he.current():xe,startIcon:x?(0,z.tZ)(et.Z,{}):(0,z.tZ)(r.Z,{}),sx:{borderRadius:"0px 4px 4px 0px"},children:a(x?"generateButton.cancel":"generateButton.generateBuilds")})})})]}),fe&&(0,z.tZ)(ri,{}),!!i&&(0,z.tZ)(xn,{status:h,characterName:ye,maxBuildsToShow:H}),(0,z.tZ)(d.Z,{children:(0,z.tZ)(Ba,{disabled:x||!q,plotBase:L,setPlotBase:be,showTooltip:!q})}),(0,z.tZ)(v.Z,{children:(0,z.BX)(Z.Z,{children:[(0,z.BX)(d.Z,{display:"flex",alignItems:"center",gap:1,mb:1,children:[(0,z.tZ)(Y.Z,{sx:{flexGrow:1},children:Q?(0,z.BX)("span",{children:["Showing ",(0,z.tZ)("strong",{children:Q.length+(o?o.length:0)})," build generated for ",ye,". ",!!ee&&(0,z.BX)("span",{children:["Build generated on: ",(0,z.tZ)("strong",{children:new Date(ee).toLocaleString()})]})]}):(0,z.tZ)("span",{children:"Select a character to generate builds."})}),(0,z.tZ)(m.Z,{disabled:!Q.length,color:"error",onClick:()=>{u(void 0),te({builds:[],buildDate:0})},children:"Clear Builds"})]}),(0,z.BX)(ue.ZP,{container:!0,display:"flex",spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(w.Hn,{size:"small"})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(w.oX,{size:"small"})}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.BX)(dt.Z,{exclusive:!0,value:l,onChange:(e,t)=>A({compareData:t}),size:"small",children:[(0,z.tZ)(lt.Z,{value:!1,disabled:!l,children:"Show new builds"}),(0,z.tZ)(lt.Z,{value:!0,disabled:l,children:"Compare vs. equipped"})]})})]})]})}),(0,z.BX)(ut.Provider,{value:q,children:[o&&(0,z.tZ)(fi,{builds:o,characterKey:i,data:ie,compareData:l,disabled:!!x,getLabel:we,setBuilds:u}),(0,z.tZ)(fi,{builds:Q,characterKey:i,data:ie,compareData:l,disabled:!!x,getLabel:Be})]})]})]})}function fi({builds:e,setBuilds:t,characterKey:n,data:a,compareData:i,disabled:l,getLabel:r}){const s=(0,f.useCallback)((n=>{if(t){const a=[...e];a.splice(n,1),t(a)}}),[e,t]);return(0,f.useMemo)((()=>(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:600}),children:null==e?void 0:e.map(((e,c)=>n&&a&&(0,z.tZ)(xi,{characterKey:n,build:e,oldData:a,children:(0,z.tZ)(gi,{index:c,label:r(c),build:e,compareData:i,disabled:l,deleteBuild:t?s:void 0})},c+e.join())))})),[e,n,a,i,l,r,s,t])}function gi({index:e,label:t,build:n,compareData:a,disabled:i,deleteBuild:l}){const{t:r}=(0,g.$G)("page_character_optimize"),c=(0,x.TH)(),o=(0,x.s0)(),d=(0,f.useCallback)((()=>{const e=c.pathname.split("/");e.pop(),o(`${e.join("/")}/theorycraft`,{state:{build:n}})}),[o,n,c.pathname]);return(0,z.tZ)(Wn,{label:t,compareBuild:a,disabled:i,extraButtonsLeft:(0,z.BX)(z.HY,{children:[(0,z.tZ)(m.Z,{color:"info",size:"small",startIcon:(0,z.tZ)(s.Z,{}),onClick:d,children:r("theorycraftButton")}),l&&(0,z.tZ)(m.Z,{color:"error",size:"small",startIcon:(0,z.tZ)(tt.Z,{}),onClick:()=>l(e),children:r("removeBuildButton")})]})})}function xi({children:e,characterKey:t,build:n,oldData:a}){const{database:i}=(0,f.useContext)(E.t),{buildSetting:{mainStatAssumptionLevel:l}}=Nt(t),[r,s]=(0,mt.Z)();(0,f.useEffect)((()=>i.arts.followAny((e=>n.includes(e)&&s()))),[i,n,s]);const c=(0,f.useMemo)((()=>r&&n.map((e=>i.arts.get(e)))),[r,n,i]),o=(0,G.Z)(t,l,c),d=(0,f.useMemo)((()=>o&&{data:o[t].target,teamData:o,oldData:a}),[o,a,t]);return d?(0,z.tZ)(X.R.Provider,{value:d,children:e}):null}var yi=n(16068),bi=n(66147),vi=n(35862),Ci=n(21626),wi=n(32560),Bi=n(85469),ki=n(86432),Si=n(99479),Xi=n(12121),Pi=n(45220),Ki=n(3694),Oi=n(71957),Ei=n(1661),ji=n(29687);let Di,Ii=e=>e;function Ai({artId:e,weaponId:t}){const{t:n}=(0,g.$G)("page_character"),[a,i,l]=(0,j.Z)(!1);return(0,z.BX)(z.HY,{children:[(0,z.tZ)(ae.Z,{open:a,onClose:l,containerProps:{maxWidth:"xl"},children:(0,z.tZ)(Ri,{artId:e,weaponId:t,onHide:l})}),(0,z.tZ)(Si.Z,{title:(0,z.tZ)(Y.Z,{children:n(Di||(Di=Ii`tabEquip.compare`))}),placement:"top",arrow:!0,children:(0,z.tZ)(m.Z,{color:"info",size:"small",onClick:i,children:(0,z.tZ)(ji.Z,{})})})]})}function Ri({artId:e,weaponId:t,onHide:n}){const{database:a}=(0,f.useContext)(E.t),{character:{key:i,equippedArtifacts:l}}=(0,f.useContext)(S.K),{buildSetting:{mainStatAssumptionLevel:r}}=Nt(i),{data:s}=(0,f.useContext)(X.R),c=(0,f.useMemo)((()=>{const t=a.arts.get(null!=e?e:""),n=(0,gt.xh)(l,((e,n)=>n===(null==t?void 0:t.slotKey)?t:a.arts.get(e)));return Object.values(n).filter((e=>e))}),[a,l,e]),o=(0,G.Z)(i,r,c,t?a.weapons.get(t):void 0),d=(0,f.useMemo)((()=>o&&{data:o[i].target,teamData:o,oldData:s}),[i,o,s]);return(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:600}),children:d&&(0,z.tZ)(X.R.Provider,{value:d,children:(0,z.tZ)(Wn,{compareBuild:!0,extraButtonsLeft:(0,z.BX)(z.HY,{children:[(0,z.tZ)(w.Hn,{size:"small"}),(0,z.tZ)(w.oX,{size:"small"})]}),extraButtonsRight:(0,z.tZ)(m.Z,{size:"small",color:"error",onClick:n,children:(0,z.tZ)(et.Z,{})})})})})}let Gi,Mi=e=>e;const Ti={xs:6,sm:6,md:9,lg:12,xl:12},_i=(0,f.lazy)((()=>n.e(726).then(n.bind(n,38726))));function Vi({onChangeId:e,slotKey:t,show:n,onClose:a}){const{t:i}=(0,g.$G)("page_character"),{database:l}=(0,f.useContext)(E.t),r=(0,f.useCallback)((t=>{e(t),a()}),[e,a]),s=(0,f.useCallback)(((e,n)=>Object.assign({},e,n,{slotKeys:[t]})),[t]),[c,o]=(0,f.useReducer)(s,Object.assign({},(0,Oi.Af)(),{slotKeys:[t]})),[h,p]=(0,mt.Z)();(0,f.useEffect)((()=>l.arts.followAny(p)),[l,p]);const m=(0,ft.Z)(),x=(0,f.useMemo)((()=>(0,Oi.EM)()),[]),y=(0,f.useMemo)((()=>{const e=(0,Ei.C)(c,x);return h&&l.arts.values.filter(e).map((e=>e.id)).slice(0,Ti[m])}),[h,l,x,c,m]);return(0,z.tZ)(ae.Z,{open:n,onClose:a,containerProps:{maxWidth:"xl"},children:(0,z.BX)(b.Z,{children:[(0,z.BX)(Z.Z,{sx:{py:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,z.BX)(Y.Z,{variant:"h6",children:[t?(0,z.tZ)(ne.Z,{src:kn.Z.slot[t]}):null," ",i(Gi||(Gi=Mi`tabEquip.swapArt`))]}),(0,z.tZ)(C.Z,{onClick:a})]}),(0,z.tZ)(F.Z,{}),(0,z.BX)(Z.Z,{children:[(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,z.tZ)(_i,{filterOption:c,filterOptionDispatch:o,filteredIds:y,disableSlotFilter:!0})}),(0,z.tZ)(d.Z,{mt:1,children:(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:300}),children:(0,z.tZ)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,md:3,lg:4},children:y.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(zn.Z,{artifactId:e,extraButtons:(0,z.tZ)(Ai,{artId:e}),onClick:r})},e)))})})})]})]})})}var Ni=n(30609),zi=n(77712);let Li,qi=e=>e;const $i=(0,Ia.X)([...T.wC]);function Wi({onChangeId:e,weaponTypeKey:t,show:n,onClose:a}){const{t:i}=(0,g.$G)(["page_character","page_weapon","weaponNames_gen"]),{database:l}=(0,f.useContext)(E.t),r=(0,f.useCallback)((t=>{e(t),a()}),[e,a]),[s,c]=(0,mt.Z)();(0,f.useEffect)((()=>l.weapons.followAny(c)),[c,l]);const o=(0,R.Z)((()=>Gn.Z.getAll),[]),[u,h]=(0,f.useState)([5,4,3]),[p,m]=(0,f.useState)(""),x=(0,f.useDeferredValue)(p),y=(0,f.useMemo)((()=>{var e,n;return null!=(e=o&&s&&l.weapons.values.filter((0,Ei.C)({weaponType:t,rarity:u,name:x},(0,zi.Xg)(o))).sort((0,Ei.e)(null!=(n=zi.gd.level)?n:[],!1,(0,zi.Sn)(o))).map((e=>e.id)))?e:[]}),[s,l,o,u,t,x]);return(0,z.tZ)(ae.Z,{open:n,onClose:a,children:(0,z.BX)(b.Z,{children:[(0,z.tZ)(Z.Z,{sx:{py:1},children:(0,z.BX)(ue.ZP,{container:!0,children:[(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.BX)(Y.Z,{variant:"h6",children:[t?(0,z.tZ)(ne.Z,{src:kn.Z.weaponTypes[t]}):null," ",i(Li||(Li=qi`page_character:tabEquip.swapWeapon`))]})}),(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(C.Z,{onClick:a})})]})}),(0,z.tZ)(F.Z,{}),(0,z.BX)(Z.Z,{children:[(0,z.BX)(ue.ZP,{container:!0,spacing:1,mb:1,children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(dt.Z,{sx:{height:"100%"},value:u,size:"small",children:T.wC.map((e=>(0,z.tZ)(lt.Z,{value:e,onClick:()=>h($i(u,e)),children:(0,z.BX)(d.Z,{display:"flex",gap:1,children:[(0,z.tZ)("strong",{children:e}),(0,z.tZ)(Tt.q,{stars:1})]})},e)))})}),(0,z.tZ)(ue.ZP,{item:!0,flexGrow:1,children:(0,z.tZ)(Ni.Z,{autoFocus:!0,size:"small",value:p,onChange:e=>m(e.target.value),label:i("page_weapon:weaponName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,children:y.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:6,sm:6,md:4,lg:3,children:(0,z.tZ)(Ki.Z,{weaponId:e,onClick:r,extraButtons:(0,z.tZ)(Ai,{weaponId:e})})},e)))})]})]})})}let Fi,Hi,Ui,Yi,Ji,Qi,el=e=>e;const tl=(0,f.lazy)((()=>n.e(592).then(n.bind(n,15878))));function nl(){var e;const{character:{equippedWeapon:t,key:n},characterSheet:a}=(0,f.useContext)(S.K),{buildSetting:{mainStatAssumptionLevel:i}}=Nt(n),{teamData:l,data:r}=(0,f.useContext)(X.R),s=null==(e=l[n])?void 0:e.weaponSheet,[c,o]=(0,f.useState)(""),u=(0,f.useCallback)((()=>o(t)),[t]),h=(0,f.useCallback)((()=>o("")),[]);(0,f.useEffect)((()=>{c&&c!==t&&o(t)}),[c,t]);const p=(0,wn.Z)(),m=(0,ki.Z)(p.breakpoints.up("lg")),g=(0,f.useMemo)((()=>s&&s.document.length>0&&(0,z.tZ)(v.Z,{children:(0,z.tZ)(Z.Z,{children:(0,z.tZ)(At.Z,{sections:s.document})})})),[s]),{rvFilter:x}=(0,wi.Z)(n),y=(0,f.useDeferredValue)(x),b=(0,f.useMemo)((()=>new Set(y)),[y]);return(0,z.BX)(d.Z,{children:[(0,z.tZ)(f.Suspense,{fallback:!1,children:(0,z.tZ)(tl,{weaponId:c,footer:!0,onClose:h,extraButtons:(0,z.tZ)(ll,{weaponTypeKey:a.weaponTypeKey})})}),(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[m&&(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:3,xl:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[g&&g,(0,z.tZ)(sl,{})]}),(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:9,xl:9,container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:12,sm:6,md:4,display:"flex",flexDirection:"column",gap:1,children:(0,z.tZ)(Ki.Z,{weaponId:t,onEdit:u,canEquip:!0,extraButtons:(0,z.tZ)(il,{weaponTypeKey:a.weaponTypeKey})})}),T.eV.map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:12,sm:6,md:4,children:r.get(xe.ri.art[e].id).value?(0,z.tZ)(zn.Z,{artifactId:r.get(xe.ri.art[e].id).value,mainStatAssumptionLevel:i,effFilter:b,extraButtons:(0,z.tZ)(rl,{slotKey:e}),editorProps:{},canExclude:!0,canEquip:!0}):(0,z.tZ)(al,{slotKey:e})},e)))]}),!m&&(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,xl:3,container:!0,spacing:1,children:[g&&(0,z.tZ)(ue.ZP,{item:!0,xs:12,md:6,lg:4,children:g}),(0,z.tZ)(ue.ZP,{item:!0,xs:12,md:6,lg:4,sx:{display:"flex",flexDirection:"column",gap:1},children:(0,z.tZ)(sl,{})})]})]})]})}function al({slotKey:e}){const{character:{key:t}}=(0,f.useContext)(S.K),{database:n}=(0,f.useContext)(E.t),[a,i,l]=(0,j.Z)();return(0,z.BX)(v.Z,{sx:{height:"100%",width:"100%",minHeight:300,display:"flex",flexDirection:"column"},children:[(0,z.tZ)(Z.Z,{children:(0,z.tZ)(Y.Z,{children:(0,z.tZ)(Gt.ZP,{slotKey:e})})}),(0,z.tZ)(F.Z,{}),(0,z.BX)(d.Z,{sx:{flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center"},children:[(0,z.tZ)(Vi,{slotKey:e,show:a,onClose:l,onChangeId:e=>n.arts.set(e,{location:(0,T.V7)(t)})}),(0,z.tZ)(m.Z,{onClick:i,color:"info",sx:{borderRadius:"1em"},children:(0,z.tZ)(Bi.Z,{sx:{height:100,width:100}})})]})]})}function il({weaponTypeKey:e}){const{t}=(0,g.$G)("page_character"),{character:{key:n}}=(0,f.useContext)(S.K),{database:a}=(0,f.useContext)(E.t),[i,l,r]=(0,j.Z)();return(0,z.BX)(z.HY,{children:[(0,z.tZ)(Si.Z,{title:(0,z.tZ)(Y.Z,{children:t(Fi||(Fi=el`tabEquip.swapWeapon`))}),placement:"top",arrow:!0,children:(0,z.tZ)(m.Z,{color:"info",size:"small",onClick:l,children:(0,z.tZ)(Bi.Z,{})})}),(0,z.tZ)(Wi,{weaponTypeKey:e,onChangeId:e=>a.weapons.set(e,{location:(0,T.V7)(n)}),show:i,onClose:r})]})}function ll({weaponTypeKey:e}){const{t}=(0,g.$G)("page_character"),{character:{key:n}}=(0,f.useContext)(S.K),{database:a}=(0,f.useContext)(E.t),[i,l,r]=(0,j.Z)();return(0,z.BX)(z.HY,{children:[(0,z.tZ)(m.Z,{color:"info",onClick:l,startIcon:(0,z.tZ)(Bi.Z,{}),children:t(Hi||(Hi=el`tabEquip.swapWeapon`))}),(0,z.tZ)(Wi,{weaponTypeKey:e,onChangeId:e=>a.weapons.set(e,{location:(0,T.V7)(n)}),show:i,onClose:r})]})}function rl({slotKey:e}){const{t}=(0,g.$G)("page_character"),{character:{key:n}}=(0,f.useContext)(S.K),{database:a}=(0,f.useContext)(E.t),[i,l,r]=(0,j.Z)();return(0,z.BX)(z.HY,{children:[(0,z.tZ)(Si.Z,{title:(0,z.tZ)(Y.Z,{children:t(Ui||(Ui=el`tabEquip.swapArt`))}),placement:"top",arrow:!0,children:(0,z.tZ)(m.Z,{color:"info",size:"small",onClick:l,children:(0,z.tZ)(Bi.Z,{})})}),(0,z.tZ)(Vi,{slotKey:e,show:i,onClose:r,onChangeId:e=>a.arts.set(e,{location:(0,T.V7)(n)})})]})}function sl(){const{t:e}=(0,g.$G)(["page_character","artifact"]),{database:t}=(0,f.useContext)(E.t),{character:n,character:{key:a,equippedArtifacts:i}}=(0,f.useContext)(S.K),{data:l}=(0,f.useContext)(X.R),r=(0,R.Z)((()=>It.y.getAll),[]),s=(0,f.useMemo)((()=>!!Object.values(i).filter((e=>e)).length),[i]),c=(0,f.useCallback)((()=>{n&&window.confirm("Do you want to move all currently equipped artifacts to inventory?")&&Object.values(i).forEach((e=>t.arts.set(e,{location:""})))}),[n,t,i]),o=(0,f.useMemo)((()=>r&&It.y.setEffects(r,l)),[r,l]),{rvFilter:d}=(0,wi.Z)(a),u=(0,f.useCallback)((e=>t.charMeta.set(a,{rvFilter:e})),[t,a]),[h,p,x]=(0,j.Z)(),y=(0,f.useDeferredValue)(d),{rvField:C,rvmField:w}=(0,f.useMemo)((()=>{const{currentEfficiency:n,currentEfficiency_:a,maxEfficiency:l,maxEfficiency_:r}=Object.values(i).reduce(((e,n)=>{const a=t.arts.get(n);if(a){const{currentEfficiency:t,maxEfficiency:n}=Sn.ZP.getArtifactEfficiency(a,new Set(y)),{currentEfficiency:i,maxEfficiency:l}=Sn.ZP.getArtifactEfficiency(a,new Set(si._));e.currentEfficiency=e.currentEfficiency+t,e.maxEfficiency=e.maxEfficiency+n,e.currentEfficiency_=e.currentEfficiency_+i,e.maxEfficiency_=e.maxEfficiency_+l}return e}),{currentEfficiency:0,currentEfficiency_:0,maxEfficiency:0,maxEfficiency_:0});return{rvField:{text:e(Yi||(Yi=el`artifact:editor.curSubEff`)),value:n-a?(0,z.BX)("span",{children:[(0,z.tZ)(Pi.Z,{value:n,max:4500,valid:!0})," / ",(0,z.tZ)(Pi.Z,{value:a,max:4500,valid:!0})]}):(0,z.tZ)(Pi.Z,{value:n,max:4500,valid:!0})},rvmField:{text:e(Ji||(Ji=el`artifact:editor.maxSubEff`)),canShow:()=>!!(a-r),value:l-r?(0,z.BX)("span",{children:[(0,z.tZ)(Pi.Z,{value:l,max:4500,valid:!0})," / ",(0,z.tZ)(Pi.Z,{value:r,max:4500,valid:!0})]}):(0,z.tZ)(Pi.Z,{value:l,max:4500,valid:!0})}}}),[e,y,i,t]);return(0,z.BX)(v.Z,{children:[s&&(0,z.tZ)(m.Z,{color:"error",onClick:c,fullWidth:!0,sx:{borderBottomRightRadius:0,borderBottomLeftRadius:0},children:e(Qi||(Qi=el`tabEquip.unequipArts`))}),(0,z.tZ)(Z.Z,{children:(0,z.BX)(de.Z,{spacing:1,children:[(0,z.BX)(b.Z,{children:[(0,z.tZ)(m.Z,{fullWidth:!0,color:"info",startIcon:(0,z.tZ)(Dt.Z,{}),sx:{borderBottomLeftRadius:0,borderBottomRightRadius:0},onClick:p,children:"RV Filter"}),(0,z.tZ)(ae.Z,{open:h,onClose:x,children:(0,z.tZ)(b.Z,{children:(0,z.tZ)(Z.Z,{children:(0,z.tZ)(Xi.Z,{selectedKeys:d,onChange:u})})})}),(0,z.BX)(Ge.lD,{children:[(0,z.tZ)(Ge.ms,{field:C,component:Ze.ZP}),(null==w||null==w.canShow?void 0:w.canShow(l))&&(0,z.tZ)(Ge.ms,{field:w,component:Ze.ZP})]})]}),r&&o&&Object.entries(o).flatMap((([e,t])=>t.map((t=>(0,z.tZ)(b.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:(0,z.tZ)(Rt,{setKey:e,setNumKey:t},e+t)},e+t)))))]})})]})}function cl(){const e=(0,f.useRef)(),t=(0,f.useCallback)((()=>{var t;return null==e||null==(t=e.current)||null==t.scrollIntoView?void 0:t.scrollIntoView({behavior:"smooth"})}),[e]);return(0,z.BX)(de.Z,{spacing:1,children:[(0,z.BX)(ue.ZP,{container:!0,spacing:1,sx:{justifyContent:"center"},children:[(0,z.tZ)(ue.ZP,{item:!0,xs:8,sm:5,md:4,lg:2.3,children:(0,z.tZ)(dl,{})}),(0,z.BX)(ue.ZP,{item:!0,xs:12,sm:7,md:8,lg:9.7,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(ol,{onClick:t}),(0,z.tZ)(v.Z,{sx:{flexGrow:1,p:1},children:(0,z.tZ)(An,{})})]})]}),(0,z.tZ)(d.Z,{ref:e,children:(0,z.tZ)(nl,{})})]})}function ol({onClick:e}){const{character:{equippedWeapon:t}}=(0,f.useContext)(S.K),{data:n}=(0,f.useContext)(X.R);return(0,z.BX)(ue.ZP,{container:!0,spacing:1,columns:{xs:2,sm:2,md:3,lg:6,xl:6},children:[(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(_n,{weaponId:t,BGComponent:v.Z,onClick:e})}),T.eV.map((t=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,children:(0,z.tZ)(En,{artifactId:n.get(xe.ri.art[t].id).value,slotKey:t,BGComponent:v.Z,onClick:e})},t)))]})}function dl(){var e;const{database:t}=(0,f.useContext)(E.t),{characterSheet:n,character:{key:a,team:i}}=(0,f.useContext)(S.K),{data:l}=(0,f.useContext)(X.R),r=(0,I.Z)(a),s=(0,x.s0)(),c=l.get(xe.ri.charEle).value,o=n.weaponTypeKey,u=l.get(xe.ri.lvl).value,Z=l.get(xe.ri.asc).value,h=l.get(xe.ri.constellation).value,p={auto:l.get(xe.ri.total.auto).value,skill:l.get(xe.ri.total.skill).value,burst:l.get(xe.ri.total.burst).value},m={auto:l.get(xe.ri.bonus.auto).value,skill:l.get(xe.ri.bonus.skill).value,burst:l.get(xe.ri.bonus.burst).value},{favorite:g}=(0,wi.Z)(a);return(0,z.BX)(v.Z,{sx:{height:"100%"},children:[(0,z.BX)(d.Z,{sx:{position:"relative"},children:[(0,z.BX)(d.Z,{sx:{position:"absolute",width:"100%",height:"100%"},children:[(0,z.tZ)(Y.Z,{variant:"h6",sx:{position:"absolute",left:"50%",bottom:0,transform:"translate(-50%, -50%)",opacity:.75},children:(0,z.tZ)(Tt.q,{stars:n.rarity,colored:!0})}),(0,z.tZ)(d.Z,{sx:{position:"absolute",left:"50%",bottom:"5%",transform:"translate(-50%, -50%)",opacity:.85,width:"100%",display:"flex",justifyContent:"center",px:1},children:(0,z.tZ)(fe.Z,{color:c,sx:{height:"auto"},label:(0,z.BX)(Y.Z,{variant:"h6",sx:{display:"flex",gap:1,alignItems:"center"},children:[ke.Z[c],(0,z.tZ)(d.Z,{sx:{whiteSpace:"normal",textAlign:"center"},children:n.name}),(0,z.tZ)(ne.Z,{src:null==(e=kn.Z.weaponTypes)?void 0:e[o]})]})})}),(0,z.tZ)(d.Z,{sx:{position:"absolute",left:0,top:0},children:(0,z.tZ)(Ce.Z,{sx:{p:1},color:"error",onClick:()=>t.charMeta.set(a,{favorite:!g}),children:g?(0,z.tZ)(yi.Z,{}):(0,z.tZ)(bi.Z,{})})}),(0,z.tZ)(Y.Z,{sx:{p:1,position:"absolute",right:0,top:0,opacity:.8},children:(0,z.tZ)(k.Z,{children:(0,Ci.wQ)(u,Z)})})]}),(0,z.tZ)(d.Z,{src:n.cardImg,component:"img",width:"100%",height:"auto"})]}),(0,z.BX)(d.Z,{children:[(0,z.tZ)(Cn.Z,{sx:{p:1},onClick:()=>s("talent"),children:(0,z.tZ)(ue.ZP,{container:!0,spacing:1,mt:-1,children:["auto","skill","burst"].map((e=>{var t;return(0,z.tZ)(ue.ZP,{item:!0,xs:4,children:(0,z.tZ)(vi.Z,{badgeContent:p[e],color:m[e]?"info":"secondary",overlap:"circular",anchorOrigin:{vertical:"bottom",horizontal:"right"},sx:{width:"100%",height:"100%","& > .MuiBadge-badge":{fontSize:"1.25em",padding:".25em .4em",borderRadius:".5em",lineHeight:1,height:"1.25em"}},children:(0,z.tZ)(d.Z,{component:"img",src:null==(t=n.getTalentOfKey(e))?void 0:t.img,width:"100%",height:"auto"})})},e)}))})}),(0,z.tZ)(Y.Z,{sx:{textAlign:"center",mt:1},variant:"h6",children:n.constellationName}),(0,z.tZ)(ue.ZP,{container:!0,spacing:1,children:(0,gt.w6)(1,6).map((e=>{var t;return(0,z.tZ)(ue.ZP,{item:!0,xs:4,children:(0,z.tZ)(Cn.Z,{onClick:()=>r({constellation:e===h?e-1:e}),children:(0,z.tZ)(d.Z,{component:"img",src:null==(t=n.getTalentOfKey(`constellation${e}`))?void 0:t.img,sx:Object.assign({},h>=e?{}:{filter:"brightness(50%)"}),width:"100%",height:"auto"})})},e)}))}),(0,z.tZ)(Cn.Z,{sx:{p:1},onClick:()=>s("teambuffs"),children:(0,z.tZ)(ue.ZP,{container:!0,columns:3,spacing:1,children:(0,gt.w6)(0,2).map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:1,height:"100%",children:(0,z.tZ)(Ha.Z,{characterKey:i[e],index:e})},e)))})})]})]})}const ul={xs:12,sm:6,md:4};function Zl(){const{character:e,characterSheet:t}=(0,f.useContext)(S.K),{data:n}=(0,f.useContext)(X.R),a=(0,I.Z)(e.key),i=n.get(xe.ri.asc).value,l=n.get(xe.ri.constellation).value,r=(0,wn.Z)(),s=(0,ki.Z)(r.breakpoints.up("lg")),c=(0,f.useMemo)((()=>(0,gt.w6)(1,6).map((e=>(0,z.tZ)(ml,{talentKey:`constellation${e}`,subtitle:`Constellation Lv. ${e}`,onClickTitle:()=>a({constellation:e===l?e-1:e})})))),[l,a]);return(0,z.BX)(z.HY,{children:[(0,z.tZ)(hl,{}),(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[s&&(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(v.Z,{children:(0,z.tZ)(Z.Z,{children:(0,z.BX)(Y.Z,{variant:"h6",sx:{textAlign:"center"},children:["Constellation Lv. ",l]})})}),c.map(((e,t)=>(0,z.tZ)(d.Z,{sx:{opacity:l>=t+1?1:.5},children:e},t)))]}),(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:9,container:!0,spacing:1,children:[[["auto","Normal/Charged Attack"],["skill","Elemental Skill"],["burst","Elemental Burst"]].map((([e,t])=>(0,z.tZ)(ue.ZP,Object.assign({item:!0},ul,{children:(0,z.tZ)(ml,{talentKey:e,subtitle:t})}),e))),!!t.getTalentOfKey("sprint")&&(0,z.tZ)(ue.ZP,Object.assign({item:!0},ul,{children:(0,z.tZ)(ml,{talentKey:"sprint",subtitle:"Alternative Sprint"})})),!!t.getTalentOfKey("passive")&&(0,z.tZ)(ue.ZP,Object.assign({item:!0},ul,{children:(0,z.tZ)(ml,{talentKey:"passive",subtitle:"Passive"})})),[["passive1","Unlocked at Ascension 1",1],["passive2","Unlocked at Ascension 4",4],["passive3","Unlocked by Default",0]].map((([e,n,a])=>{const l=i>=a;return t.getTalentOfKey(e)?(0,z.tZ)(ue.ZP,Object.assign({item:!0,style:{opacity:l?1:.5}},ul,{children:(0,z.tZ)(ml,{talentKey:e,subtitle:n})}),e):null}))]}),!s&&(0,z.BX)(ue.ZP,{item:!0,xs:12,md:12,lg:3,container:!0,spacing:1,children:[(0,z.tZ)(ue.ZP,{item:!0,xs:12,children:(0,z.tZ)(v.Z,{children:(0,z.tZ)(Z.Z,{children:(0,z.BX)(Y.Z,{variant:"h6",sx:{textAlign:"center"},children:["Constellation Lv. ",l]})})})}),c.map(((e,t)=>(0,z.tZ)(ue.ZP,Object.assign({item:!0,sx:{opacity:l>=t+1?1:.5}},ul,{children:e}),t)))]})]})]})}function hl(){const{data:e}=(0,f.useContext)(X.R),t=e.getDisplay().reaction;return(0,z.tZ)(v.Z,{children:(0,z.tZ)(Z.Z,{children:(0,z.tZ)(ue.ZP,{container:!0,spacing:1,children:Object.entries(t).filter((([e,t])=>!t.isEmpty)).map((([e,t])=>(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(b.Z,{children:(0,z.tZ)(Z.Z,{sx:{p:1,"&:last-child":{pb:1}},children:(0,z.tZ)(Ge.JW,{node:t})})})},e)))})})})}const pl=[1,1,2,4,6,8,10];function ml({talentKey:e,subtitle:t,onClickTitle:n}){const{character:{talent:a},characterSheet:i,characterDispatch:l}=(0,f.useContext)(S.K),{data:r}=(0,f.useContext)(X.R),s=(0,f.useCallback)((e=>(0,z.tZ)(Cn.Z,{onClick:n,children:e})),[n]),c=(0,f.useCallback)(((e,t)=>l({talent:Object.assign({},a,{[e]:t})})),[a,l]);let o=null;if(e in a){const t=r.get(xe.ri.bonus[e]).value,n=r.get(xe.ri.total[e]).value,i=r.get(xe.ri.asc).value;o=(0,z.tZ)(ot.Z,{fullWidth:!0,title:`Talent Lv. ${n}`,color:t?"info":"primary",sx:{borderRadius:0},children:(0,gt.w6)(1,pl[i]).map((n=>(0,z.BX)(it.Z,{selected:a[e]===n,disabled:a[e]===n,onClick:()=>c(e,n),children:["Talent Lv. ",n+t]},n)))})}const u=i.getTalentOfKey(e);return(0,z.BX)(v.Z,{sx:{height:"100%"},children:[o,(0,z.BX)(Z.Z,{children:[(0,z.tZ)(Pn.Z,{condition:!!n,wrapper:s,children:(0,z.BX)(ue.ZP,{container:!0,sx:{flexWrap:"nowrap"},children:[(0,z.tZ)(ue.ZP,{item:!0,children:(0,z.tZ)(d.Z,{component:"img",src:null==u?void 0:u.img,sx:{width:60,height:"auto"}})}),(0,z.BX)(ue.ZP,{item:!0,flexGrow:1,sx:{pl:1},children:[(0,z.tZ)(Y.Z,{variant:"h6",children:null==u?void 0:u.name}),(0,z.tZ)(Y.Z,{variant:"subtitle1",children:t})]})]})}),null!=u&&u.sections?(0,z.tZ)(At.Z,{sections:u.sections,hideDesc:!0,hideHeader:t=>{var n;const a=null==(n=t.header)?void 0:n.action;if(a&&"string"!=typeof a){return a.props.children.props.key18.includes(e)}return!1}}):null]})]})}var fl=n(88819),gl=n(86482),xl=n(39429);let yl,bl=e=>e;function vl(){return(0,z.tZ)(d.Z,{display:"flex",flexDirection:"column",gap:1,alignItems:"stretch",children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,children:[(0,z.BX)(ue.ZP,{item:!0,xs:12,md:6,lg:3,sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.tZ)(Cl,{}),(0,z.tZ)(wl,{})]}),(0,gt.w6)(0,2).map((e=>(0,z.tZ)(ue.ZP,{item:!0,xs:12,md:6,lg:3,children:(0,z.tZ)(Bl,{index:e})},e)))]})})}function Cl(){var e,t,n;const{data:a,oldData:i}=(0,f.useContext)(X.R),l=a.getTeamBuff(),r=[];return Object.entries(null!=(e=l.total)?e:{}).forEach((([e,t])=>!t.isEmpty&&0!==t.value&&r.push([["total",e],t]))),Object.entries(null!=(t=l.premod)?t:{}).forEach((([e,t])=>!t.isEmpty&&0!==t.value&&r.push([["premod",e],t]))),Object.entries(null!=(n=l.enemy)?n:{}).forEach((([e,t])=>!t.isEmpty&&"number"==typeof t.value&&0!==t.value&&r.push([["enemy",e],t]))),r.length?(0,z.BX)(v.Z,{children:[(0,z.tZ)(Z.Z,{children:(0,z.tZ)(Y.Z,{children:"Team Buffs"})}),(0,z.tZ)(F.Z,{}),(0,z.tZ)(Z.Z,{children:(0,z.tZ)(ue.ZP,{container:!0,children:r.map((([e,t])=>{var n;return t&&(0,z.tZ)(ue.ZP,{item:!0,xs:12,children:(0,z.tZ)(Ge.JW,{node:t,oldValue:null==(n=(0,gt.Hm)(null==i?void 0:i.getTeamBuff(),e))?void 0:n.value})},JSON.stringify(t.info))}))})})]}):null}function wl(){const{t:e}=(0,g.$G)("page_character"),{data:t}=(0,f.useContext)(X.R),{character:{team:n}}=(0,f.useContext)(S.K),a=n.reduce(((e,t)=>e+(t?1:0)),1);return(0,z.BX)(z.HY,{children:[(0,z.tZ)(v.Z,{children:(0,z.tZ)(W.Z,{title:(0,z.BX)("span",{children:[e("tabTeambuff.team_reso")," ",(0,z.tZ)("strong",{children:(0,z.BX)(te.Z,{color:a>=4?"success":"warning",children:["(",a,"/4)"]})})," ",(0,z.tZ)(Mt.Z,{title:(0,z.tZ)(Y.Z,{children:e(yl||(yl=bl`tabTeambuff.resonance_tip`))})})]}),titleTypographyProps:{variant:"subtitle2"}})}),xl.J.map(((e,n)=>{const a=(0,z.tZ)(Mt.Z,{title:(0,z.tZ)(Y.Z,{children:e.desc})}),i=(0,z.BX)("span",{children:[e.name," ",a]});return(0,z.BX)(v.Z,{sx:{opacity:e.canShow(t)?1:.5},children:[(0,z.tZ)(W.Z,{title:i,action:e.icon,titleTypographyProps:{variant:"subtitle2"}}),e.canShow(t)&&(0,z.tZ)(F.Z,{}),e.canShow(t)&&(0,z.tZ)(Z.Z,{children:(0,z.tZ)(At.Z,{sections:e.sections,teamBuffOnly:!0,hideDesc:!0})})]},n)}))]})}function Bl({index:e}){const{teamData:t}=(0,f.useContext)(X.R),{t:n}=(0,g.$G)("page_character"),{character:a,character:{key:i},characterDispatch:l}=(0,f.useContext)(S.K),r=a.team[e],s=(0,f.useMemo)((()=>[i,...a.team].filter(((t,n)=>n-1!==e))),[a.team,i,e]),c=(0,N.Z)(),o=(0,f.useCallback)((t=>l({type:"team",index:e,charKey:t})),[e,l]),d=t[r],u=(0,f.useMemo)((()=>{var e;return d&&{character:Object.assign({},d.character,{conditional:null!=(e=a.teamConditional[r])?e:{}}),characterSheet:d.characterSheet,characterDispatch:e=>{if(!r)return;if(!("conditional"in e))return;const{conditional:t}=e;t&&l({type:"teamConditional",teamMateKey:r,conditional:t})}}}),[a,r,d,l]),Z=(0,f.useMemo)((()=>d&&{data:d.target,teamData:t}),[d,t]);return(0,z.BX)(v.Z,{sx:{overflow:"visible"},children:[(0,z.tZ)(Pl,{characterKey:r,team:s,setChar:o,label:n("teammate",{count:e+1})}),r&&u&&(0,z.tZ)(S.K.Provider,{value:u,children:Z&&(0,z.tZ)(X.R.Provider,{value:Z,children:(0,z.tZ)(ct.Z,{characterKey:r,onClickHeader:c,artifactChildren:(0,z.tZ)(S.K.Provider,{value:u,children:(0,z.tZ)(X.R.Provider,{value:Z,children:(0,z.tZ)(kl,{})})}),weaponChildren:(0,z.tZ)(S.K.Provider,{value:u,children:(0,z.tZ)(X.R.Provider,{value:Z,children:(0,z.tZ)(Sl,{})})}),characterChildren:(0,z.tZ)(S.K.Provider,{value:u,children:(0,z.tZ)(X.R.Provider,{value:Z,children:(0,z.tZ)(Xl,{})})}),isTeammateCard:!0})})})]})}function kl(){const{data:e}=(0,f.useContext)(X.R),t=(0,R.Z)((()=>It.y.getAll),[]),n=(0,f.useMemo)((()=>t&&Object.entries(It.y.setEffects(t,e)).flatMap((([e,n])=>n.flatMap((n=>t(e).setEffectDocument(n)))))),[t,e]);return n?(0,z.tZ)(At.Z,{sections:n,teamBuffOnly:!0}):null}function Sl(){const{character:{key:e}}=(0,f.useContext)(S.K),{teamData:t}=(0,f.useContext)(X.R),n=t[e].weaponSheet;return n.document?(0,z.tZ)(At.Z,{sections:n.document,teamBuffOnly:!0}):null}function Xl(){const{character:{key:e}}=(0,f.useContext)(S.K),{teamData:t}=(0,f.useContext)(X.R),n=t[e].characterSheet,a=Object.values(n.talent).flatMap((e=>e.sections));return a?(0,z.tZ)(At.Z,{sections:a,teamBuffOnly:!0}):null}function Pl({characterKey:e,team:t,label:n,setChar:a,autoCompleteProps:i={}}){const{t:l}=(0,g.$G)(["charNames_gen","page_character","sheet_gen"]),{database:r}=(0,f.useContext)(E.t),{gender:s}=(0,A.Z)(),c=(0,R.Z)((()=>O.Z.getAll),[]),o=(0,f.useCallback)((e=>{var t;return e.startsWith("Traveler")?`${l(`charNames_gen:${(0,T.LP)(e,s)}`)} (${l(`sheet_gen:element.${null==c||null==(t=c(e,s))?void 0:t.elementKey}`)})`:l(`charNames_gen:${e}`)}),[c,l,s]),d=(0,f.useCallback)((e=>{var t;return""===e?(0,z.tZ)(fl.Z,{}):c?(0,z.tZ)(V.Z,{src:null==(t=c(e,s))?void 0:t.thumbImgSide,sx:{pr:1}}):(0,z.tZ)(z.HY,{})}),[c,s]),Z=(0,f.useCallback)((e=>r.charMeta.get(e).favorite),[r]),h=(0,f.useCallback)((({key:n})=>t.filter((t=>t&&t!==e)).includes(n)||n.startsWith("Traveler")&&t.some(((e,t)=>e.startsWith("Traveler")))),[t,e]),p=(0,f.useMemo)((()=>r.chars.keys.map((e=>({key:e,label:o(e),favorite:Z(e)}))).sort(((e,t)=>e.favorite&&!t.favorite?-1:!e.favorite&&t.favorite?1:e.label.localeCompare(t.label)))),[o,Z,r]);return(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"text",width:100}),children:(0,z.tZ)(gl._,Object.assign({size:"small",label:n,options:p,valueKey:e,onChange:e=>a(null!=e?e:""),getOptionDisabled:h,toImg:d},i))})}var Kl=n(71076),Ol=n(97183),El=n(31114),jl=n(17206),Dl=n(38502),Il=n(14520),Al=n(69278),Rl=n(64120);let Gl,Ml=e=>e;function Tl(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}const _l=f.lazy((()=>n.e(592).then(n.bind(n,89431))));function Vl(){var e,t;const{database:n}=(0,f.useContext)(E.t),{data:a}=(0,f.useContext)(X.R),{character:i,character:{key:l,compareData:r},characterSheet:s,characterDispatch:c}=(0,f.useContext)(S.K),o=function(e,t){const{database:n}=(0,f.useContext)(E.t),[a,i]=(0,f.useState)((()=>n.charTCs.getWithInit(e,t)));return(0,f.useEffect)((()=>i(n.charTCs.getWithInit(e,t))),[n,e,t]),(0,f.useEffect)((()=>e?n.charTCs.follow(e,((e,t,n)=>"update"===t&&i(n))):void 0),[e,i,n]),a}(l,(0,Rl.mT)(s.weaponTypeKey)),Z=(0,f.useCallback)((e=>n.charTCs.set(l,e)),[l,n]),h=(0,f.useCallback)((()=>{Z((0,Al.O)((0,Rl.mT)(s.weaponTypeKey)))}),[Z,s]),p=(0,f.useCallback)((e=>{Z(Object.assign({},o,{weapon:Object.assign({},o.weapon,e)}))}),[Z,o]),g=(0,f.useCallback)(((e,t)=>{const n=(0,Al.O)(e.key);n.artifact.substats.type=o.artifact.substats.type,n.weapon.level=e.level,n.weapon.ascension=e.ascension,n.weapon.refinement=e.refinement;const a={};t.forEach((e=>{var t;if(!e)return;const{slotKey:i,setKey:l,substats:r,mainStatKey:s,level:c,rarity:o}=e;n.artifact.slots[i].level=c,n.artifact.slots[i].statKey=s,n.artifact.slots[i].rarity=o,a[l]=(null!=(t=a[l])?t:0)+1,r.forEach((e=>{var t;e.key&&(n.artifact.substats.stats[e.key]=(null!=(t=n.artifact.substats.stats[e.key])?t:0)+e.accurateValue)}))})),n.artifact.sets=Object.fromEntries(Object.entries(a).map((([e,t])=>[e,3===t?2:5===t?4:1!==t||e.startsWith("PrayersFor")?t:0])).filter((([e,t])=>t))),Z(n)}),[o,Z]),y=(0,x.TH)(),{build:b}=null!=(e=y.state)?e:{build:void 0};(0,f.useEffect)((()=>{if(!b)return;const e=n.weapons.get(i.equippedWeapon);g(e,b.map((e=>n.arts.get(e))))}),[b,n]);const C=(0,f.useCallback)((()=>{const e=n.weapons.get(i.equippedWeapon);g(e,Object.values(i.equippedArtifacts).map((e=>n.arts.get(e))).filter((e=>e)))}),[n,i.equippedArtifacts,i.equippedWeapon,g]),w=(0,f.useMemo)((()=>Object.assign({},o.weapon,{location:"",lock:!1,id:""})),[o]),B=(0,f.useCallback)((e=>{const t=(0,gt.I8)(o);t.artifact=e,Z(t)}),[o,Z]),k=(0,f.useCallback)((e=>{const t=(0,gt.I8)(o);t.artifact.substats.type=e,Z(t)}),[o,Z]),P=(0,f.useCallback)((e=>{const t=(0,gt.I8)(o);t.artifact.substats.stats=e,Z(t)}),[o,Z]),K=(0,f.useDeferredValue)(o),O=(0,f.useMemo)((()=>{const e=Object.assign({},K.artifact.substats.stats);return Object.values(K.artifact.slots).forEach((({statKey:t,rarity:n,level:a})=>{var i;return e[t]=(null!=(i=e[t])?i:0)+Sn.ZP.mainStatValue(t,n,a)})),{art:(0,gt.xh)(e,((e,t)=>t.endsWith("_")?(0,bt.aQ)(e/100):(0,bt.a9)(e))),artSet:(0,gt.xh)(K.artifact.sets,(e=>(0,bt.a9)(e)))}}),[K]),j=(0,f.useMemo)((()=>({id:"",location:"",key:o.weapon.key,level:o.weapon.level,ascension:o.weapon.ascension,refinement:o.weapon.refinement,lock:!1})),[o]),D=(0,G.Z)(l,0,O,j),{target:I}=null!=(t=null==D?void 0:D[l])?t:{},A=(0,f.useMemo)((()=>{if(D&&I)return{data:I,teamData:D}}),[I,D]),R=(0,f.useMemo)((()=>{if(A)return Object.assign({},A,{oldData:r?a:void 0})}),[A,r,a]);return(0,z.BX)(de.Z,{spacing:1,children:[(0,z.tZ)(v.Z,{children:(0,z.BX)(d.Z,{sx:{display:"flex",gap:1,p:1},children:[(0,z.BX)(d.Z,{sx:{flexGrow:1,display:"flex",gap:1},children:[(0,z.tZ)(m.Z,{color:"info",onClick:C,startIcon:(0,z.tZ)(Kl.Z,{}),children:"Copy from equipped"}),(0,z.tZ)(m.Z,{color:"error",onClick:h,startIcon:(0,z.tZ)(Ol.Z,{}),children:"Reset"})]}),(0,z.BX)(dt.Z,{exclusive:!0,value:r,onChange:(e,t)=>c({compareData:t}),size:"small",children:[(0,z.tZ)(lt.Z,{value:!1,disabled:!r,children:"Show TC stats"}),(0,z.tZ)(lt.Z,{value:!0,disabled:r,children:"Compare vs. equipped"})]})]})}),A?(0,z.tZ)(X.R.Provider,{value:A,children:(0,z.BX)(ue.ZP,{container:!0,spacing:1,sx:{justifyContent:"center"},children:[(0,z.BX)(ue.ZP,{item:!0,sx:{flexGrow:-1},children:[(0,z.tZ)(Nl,{weapon:w,setWeapon:p,weaponTypeKey:s.weaponTypeKey}),(0,z.tZ)(zl,{artifactData:o.artifact,setArtifactData:B})]}),(0,z.tZ)(ue.ZP,{item:!0,sx:{flexGrow:1},children:(0,z.tZ)(Wl,{substats:o.artifact.substats.stats,setSubstats:P,substatsType:o.artifact.substats.type,setSubstatsType:k,mainStatKeys:Object.values(o.artifact.slots).map((e=>e.statKey))})})]})}):(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:500}),(0,z.tZ)(v.Z,{sx:{flexGrow:1,p:1},children:R?(0,z.tZ)(X.R.Provider,{value:R,children:(0,z.tZ)(An,{})}):(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:500})})]})}function Nl({weapon:e,setWeapon:t,weaponTypeKey:n}){const{key:a,level:i=0,refinement:l=1,ascension:r=0}=e,s=(0,R.Z)((()=>Gn.Z.get(a)),[a]),[c,o,u]=(0,j.Z)(),{data:Z}=(0,f.useContext)(X.R),h=(0,f.useMemo)((()=>s&&e&&(0,ht.mP)([s.data,(0,ht.v0)(e)])),[s,e]);return(0,z.BX)(v.Z,{sx:{p:1,mb:1},children:[(0,z.tZ)(_l,{ascension:r,show:c,onHide:u,onSelect:e=>t({key:e}),weaponTypeFilter:n}),(0,z.BX)(d.Z,{display:"flex",flexDirection:"column",gap:1,children:[(0,z.BX)(d.Z,{display:"flex",gap:1,children:[s&&(0,z.tZ)(d.Z,{className:`grad-${s.rarity}star`,component:"img",src:s.getImg(e.ascension),sx:{flexshrink:1,flexBasis:0,maxWidth:"30%",borderRadius:1}}),(0,z.BX)(de.Z,{spacing:1,flexGrow:1,children:[(0,z.tZ)(m.Z,{fullWidth:!0,color:"info",sx:{flexGrow:1},onClick:o,children:(0,z.tZ)(d.Z,{sx:{maxWidth:"10em"},children:null==s?void 0:s.name})}),(null==s?void 0:s.hasRefinement)&&(0,z.tZ)(Il.Z,{refinement:l,setRefinement:e=>t({refinement:e})})]})]}),s&&(0,z.tZ)(B.Z,{level:i,ascension:r,setBoth:t,useLow:!s.hasRefinement}),(0,z.BX)(b.Z,{children:[(0,z.tZ)(W.Z,{title:"Main Stats",titleTypographyProps:{variant:"subtitle2"}}),(0,z.tZ)(F.Z,{}),h&&(0,z.tZ)(Ge.lD,{children:[xe.ri.weapon.main,xe.ri.weapon.sub,xe.ri.weapon.sub2].map(((e,t)=>{const n=h.get(e);return n.isEmpty||!n.value?null:(0,z.tZ)(Ge.JW,{node:n,component:Ze.ZP},JSON.stringify(n.info))}))})]}),Z&&(null==s?void 0:s.document)&&(0,z.tZ)(At.Z,{sections:s.document})]})]})}function zl({artifactData:e,setArtifactData:t}){const n=(0,f.useCallback)((n=>a=>{const i=(0,gt.I8)(e);i.slots[n]=a,t(i)}),[e,t]),a=(0,f.useCallback)((n=>{const a=(0,gt.I8)(e);a.sets=n,t(a)}),[e,t]);return(0,z.BX)(de.Z,{spacing:1,children:[(0,z.tZ)(v.Z,{sx:{p:1},children:(0,z.tZ)(de.Z,{spacing:1,children:T.eV.map((t=>(0,z.tZ)(Ll,{slotKey:t,slot:e.slots[t],setSlot:n(t)},t)))})}),(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:200}),children:(0,z.tZ)(ql,{artSet:e.sets,setArtSet:a})})]})}function Ll({slotKey:e,slot:t,setSlot:n}){var a;const{level:i,statKey:l,rarity:r}=t,s=Sn.ZP.slotMainStats(e),c=(0,f.useCallback)((e=>{n(Object.assign({},t,e))}),[t,n]),o=(0,f.useCallback)((e=>{var t;const n=null!=(t=Sn.P4[e])?t:0;c(i>n?{rarity:e,level:n}:{rarity:e})}),[i,c]);return(0,z.BX)(d.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,z.tZ)(Dl.Z,{icon:Gt.xe[e]}),(0,z.tZ)(b.Z,{sx:{height:"100%",minWidth:"5em",flexGrow:1,display:"flex"},children:1===s.length?(0,z.BX)(d.Z,{p:1,justifyContent:"center",alignItems:"center",width:"100%",display:"flex",gap:1,children:[ke.Z[s[0]],ye.ZP.getStr(s[0])]}):(0,z.tZ)(ot.Z,{sx:{px:0},fullWidth:!0,title:(0,z.tZ)(Kn.x,{statKey:l}),color:null!=(a=ye.ZP.getVariant(l))?a:"success",children:s.map((e=>(0,z.tZ)(it.Z,{disabled:l===e,onClick:()=>c({statKey:e}),children:(0,z.tZ)(Kn._,{statKey:e})},e)))})}),(0,z.tZ)(ot.Z,{sx:{px:0},title:(0,z.BX)("span",{children:[r," ",(0,z.tZ)(jt.G,{icon:Et.Tab})]}),children:[5,4,3].map((e=>(0,z.tZ)(it.Z,{disabled:r===e,onClick:()=>o(e),children:(0,z.BX)("span",{children:[e," ",(0,z.tZ)(jt.G,{icon:Et.Tab})]})},e)))}),(0,z.tZ)(Xe.ZP,{startAdornment:"+",value:i,color:Sn.ZP.levelVariant(i),onChange:e=>void 0!==e&&c({level:e}),sx:{borderRadius:1,pl:1,my:0,height:"100%"},inputProps:{sx:{pl:.5,width:"2em"},max:20,min:0}}),(0,z.tZ)(b.Z,{sx:{height:"100%",minWidth:"4em"},children:(0,z.tZ)(d.Z,{p:1,textAlign:"center",children:`${(0,ye.qs)(Sn.ZP.mainStatValue(l,r,i),ye.ZP.unit(l))}${ye.ZP.unit(l)}`})})]})}function ql({artSet:e,setArtSet:t}){const n=(0,R.Z)((()=>It.y.getAll),[]),a=(0,f.useCallback)((a=>{a&&n&&t(Object.assign({},e,{[a]:parseInt(Object.keys(n(a).setEffects)[0])}))}),[e,t,n]),i=(0,f.useCallback)((n=>a=>t(Object.assign({},e,{[n]:a}))),[e,t]),l=(0,f.useCallback)((n=>()=>{const a=(0,be.Z)(e,[n].map(Tl));t(Object.assign({},a))}),[e,t]),r=5-Object.values(e).reduce(((e,t)=>e+t),0);return(0,z.BX)(de.Z,{spacing:1,sx:{flexGrow:1},children:[Object.entries(e).map((([e,t])=>(0,z.tZ)($l,{setKey:e,value:t,setValue:i(e),deleteValue:l(e),remaining:r},e))),(0,z.tZ)(v.Z,{sx:{flexGrow:1,overflow:"visible"},children:(0,z.tZ)(jl.Z,{disableClearable:!0,artSetKey:"",setArtSetKey:a,label:"New Artifact Set",getOptionDisabled:({key:t})=>Object.keys(e).includes(t)||!(t&&null!=n&&n(t))||Object.keys(n(t).setEffects).every((e=>parseInt(e)>r))})})]})}function $l({setKey:e,value:t,setValue:n,deleteValue:a,remaining:i}){const l=(0,R.Z)((()=>It.y.get(e)),[]),r=(0,f.useMemo)((()=>t<4||!l?[]:Object.keys(l.setEffects).filter((e=>{var t;return null==(t=l.setEffects[e])?void 0:t.document.some((e=>"states"in e))}))),[l,t]);return l?(0,z.BX)(v.Z,{children:[(0,z.BX)(d.Z,{display:"flex",children:[(0,z.tZ)(Ln.Z,{artifactSheet:l,numInSet:t,children:(0,z.BX)(d.Z,{flexGrow:1,p:1,display:"flex",gap:1,alignItems:"center",children:[(0,z.tZ)(ne.Z,{size:2,sx:{m:-1},src:l.defIconSrc}),(0,z.tZ)(d.Z,{children:l.setName}),(0,z.tZ)(El.Z,{})]})}),(0,z.BX)(Se.Z,{children:[(0,z.tZ)(ot.Z,{size:"small",title:(0,z.BX)(d.Z,{whiteSpace:"nowrap",children:[t,"-set"]}),children:Object.keys(l.setEffects).map((e=>parseInt(e))).map((e=>(0,z.BX)(it.Z,{disabled:t===e||e>i+t,onClick:()=>n(e),children:[e,"-set"]},e)))}),(0,z.tZ)(m.Z,{color:"error",size:"small",onClick:a,children:(0,z.tZ)(tt.Z,{})})]})]}),!!r.length&&(0,z.tZ)(de.Z,{spacing:1,sx:{p:1},children:r.map((t=>(0,z.tZ)(Rt,{setKey:e,setNumKey:parseInt(t),hideHeader:!0,conditionalsOnly:!0},t)))})]}):null}function Wl({substats:e,setSubstats:t,substatsType:n,setSubstatsType:a,mainStatKeys:i}){const l=(0,f.useCallback)((n=>a=>t(Object.assign({},e,{[n]:a}))),[e,t]),{t:r}=(0,g.$G)("page_character"),s=100*Object.entries(e).reduce(((e,[t,n])=>e+n/Sn.ZP.substatValue(t)),0),c=Object.entries(e).reduce(((e,[t,a])=>e+a/Sn.ZP.substatValue(t,void 0,n)),0);return(0,z.BX)(v.Z,{sx:{p:1,height:"100%"},children:[(0,z.BX)(d.Z,{sx:{mb:1,display:"flex",gap:1},children:[(0,z.tZ)(ot.Z,{fullWidth:!0,title:r(`tabTheorycraft.substatType.${n}`),children:T.Q7.map((e=>(0,z.tZ)(it.Z,{disabled:n===e,onClick:()=>a(e),children:r(`tabTheorycraft.substatType.${e}`)},e)))}),(0,z.tZ)(st.Z,{title:(0,z.tZ)(Y.Z,{children:r(Gl||(Gl=Ml`tabTheorycraft.maxTotalRolls`))}),placement:"top",children:(0,z.BX)(b.Z,{sx:{textAlign:"center",py:.5,px:1,minWidth:"15em",whiteSpace:"nowrap",display:"flex",gap:2,justifyContent:"flex-end",alignItems:"center"},children:[(0,z.BX)(te.Z,{color:c>45?"warning":void 0,children:["Rolls: ",(0,z.tZ)("strong",{children:c.toFixed(0)})]}),(0,z.BX)(te.Z,{color:c>45?"warning":void 0,children:["RV: ",(0,z.BX)("strong",{children:[s.toFixed(1),"%"]})]})]})})]}),(0,z.tZ)(de.Z,{spacing:1,children:Object.entries(e).map((([e,t])=>(0,z.tZ)(Fl,{statKey:e,value:t,setValue:l(e),substatsType:n,mainStatKeys:i},e)))})]})}function Fl({statKey:e,value:t,setValue:n,substatsType:a,mainStatKeys:i}){const{t:l}=(0,g.$G)("page_character"),r=Sn.ZP.substatValue(e,5,a),[s,c]=(0,f.useState)((()=>t/r));(0,f.useEffect)((()=>c(t/r)),[t,r]);const o=ye.ZP.unit(e),u=s*r,Z=s*r/Sn.ZP.substatValue(e)*100,h=i.reduce(((t,n)=>t+(n===e?1:0)),0),p=6*(5-h),m=s-1e-4>p,x=(0,f.useCallback)((e=>n(e*r)),[n,r]);return(0,z.BX)(de.Z,{spacing:.5,children:[(0,z.BX)(d.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,z.BX)(b.Z,{sx:{p:.5,minWidth:"11em",flexGrow:1,display:"flex",gap:1,alignItems:"center",justifyContent:"center"},children:[ke.Z[e],ye.ZP.getStr(e),ye.ZP.unit(e)]}),(0,z.tZ)(st.Z,{title:(0,z.tZ)(Y.Z,{children:l(h?"tabTheorycraft.maxRollsMain":"tabTheorycraft.maxRolls",{value:p})}),placement:"top",children:(0,z.tZ)(b.Z,{sx:{textAlign:"center",p:.5,minWidth:"8em"},children:(0,z.BX)(te.Z,{color:m?"warning":void 0,children:["RV: ",(0,z.BX)("strong",{children:[Z.toFixed(1),"%"]})]})})})]}),(0,z.BX)(d.Z,{display:"flex",gap:1,justifyContent:"space-between",alignItems:"center",children:[(0,z.tZ)(Xe.ZP,{color:u?"success":"primary",float:"%"===ye.ZP.unit(e),endAdornment:ye.ZP.unit(e)||(0,z.tZ)(d.Z,{width:"1em",component:"span"}),value:parseFloat(u.toFixed(2)),onChange:e=>void 0!==e&&n(e),sx:{borderRadius:1,px:1,height:"100%",width:"6em"},inputProps:{sx:{textAlign:"right"},min:0}}),(0,z.tZ)(b.Z,{sx:{px:2,flexGrow:1,display:"flex",gap:1,alignItems:"center",justifyContent:"center",overflow:"visible"},children:(0,z.tZ)(Un.ZP,{size:"small",value:s,max:p,min:0,step:1,marks:!0,valueLabelDisplay:"auto",onChange:(e,t)=>c(t),onChangeCommitted:(e,t)=>x(t)})}),(0,z.tZ)(Xe.ZP,{color:t?m?"warning":"success":"primary",float:!0,startAdornment:(0,z.BX)(d.Z,{sx:{whiteSpace:"nowrap",width:"7em",display:"flex",justifyContent:"space-between"},children:[(0,z.BX)("span",{children:[(0,ye.qs)(r,o),o]}),(0,z.tZ)("span",{children:"x"})]}),value:parseFloat(s.toFixed(2)),onChange:e=>void 0!==e&&n(e*r),sx:{borderRadius:1,px:1,my:0,height:"100%",width:"7em"},inputProps:{sx:{textAlign:"right",pr:.5},min:0,step:1}})]})]})}var Hl=n(62173);function Ul(){const{character:e}=(0,f.useContext)(S.K),{key:t}=e,n=(0,N.Z)();if(!t.startsWith("Traveler"))return null;const a=T.N.find((e=>t.toLowerCase().includes(e)));return(0,z.tZ)(ot.Z,{color:a,title:(0,z.tZ)("strong",{children:(0,Hl.el)(`element.${a}`)}),children:T.DZ.map((e=>(0,z.tZ)(it.Z,{selected:a===e,disabled:a===e,onClick:()=>n((0,T.rq)(t,e)),children:(0,z.tZ)("strong",{children:(0,z.tZ)(te.Z,{color:e,children:(0,Hl.el)(`element.${e}`)})})},e)))})}var Yl=n(2247),Jl=n(96608);function Ql(){const{t:e}=(0,g.$G)("ui"),{database:t}=(0,f.useContext)(E.t),{character:n}=(0,f.useContext)(S.K),{key:a}=n,{gender:i}=(0,A.Z)(),l=(0,f.useCallback)((()=>t.dbMeta.set({gender:"F"===i?"M":"F"})),[i,t]);return a.startsWith("Traveler")?(0,z.BX)(m.Z,{onClick:l,startIcon:"F"===i?(0,z.tZ)(Yl.Z,{}):(0,z.tZ)(Jl.Z,{}),children:[(0,z.tZ)("strong",{children:e(`gender.${i}`)}),"  "]}):null}let er,tr=e=>e;function nr(){const e=(0,x.s0)(),{database:t}=(0,f.useContext)(E.t),n=(0,f.useCallback)((()=>e("/characters")),[e]),{characterKey:a}=(0,x.UO)();return!t.chars.keys.includes(a)?(0,z.tZ)(x.Fg,{to:"/characters"}):(0,z.tZ)(d.Z,{my:1,display:"flex",flexDirection:"column",gap:1,children:(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:1e3}),children:a&&(0,z.tZ)(ar,{characterKey:a,onClose:n})})})}function ar({characterKey:e,onClose:t}){var n,a,i;const l=(0,D.Z)(e),{gender:r}=(0,A.Z)(),s=(0,R.Z)((()=>O.Z.get(e,r)),[e,r]),c=(0,G.Z)(e),{target:o}=null!=(n=null==c?void 0:c[e])?n:{},{params:{tab:h="overview"}}=null!=(a=(0,x.bS)({path:"/characters/:charKey/:tab",end:!1}))?a:{params:{tab:"overview"}},{t:p}=(0,g.$G)(["charNames_gen","page_character"]);(0,M.Z)((0,f.useMemo)((()=>`${p(`charNames_gen:${(0,T.LP)(e,r)}`)} - ${p(`page_character:tabs.${h}`)}`),[p,e,r,h]));const m=(0,I.Z)(null!=(i=null==l?void 0:l.key)?i:""),y=(0,f.useMemo)((()=>{if(c&&o)return{data:o,teamData:c,oldData:void 0}}),[o,c]),k=(0,f.useMemo)((()=>{if(l&&s)return{character:l,characterSheet:s,characterDispatch:m}}),[l,s,m]),[E,j]=(0,f.useState)(void 0),[V,N]=(0,f.useState)(),L=(0,f.useMemo)((()=>({chartData:E,setChartData:j,graphBuilds:V,setGraphBuilds:N})),[E,V]);return(0,f.useEffect)((()=>{j(void 0),N(void 0)}),[e]),(0,z.tZ)(b.Z,{children:y&&k&&L?(0,z.tZ)(S.K.Provider,{value:k,children:(0,z.tZ)(X.R.Provider,{value:y,children:(0,z.tZ)(K.Provider,{value:L,children:(0,z.tZ)(P.B,{children:(0,z.BX)(Z.Z,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,z.BX)(d.Z,{display:"flex",children:[(0,z.BX)(d.Z,{display:"flex",gap:1,flexWrap:"wrap",flexGrow:1,children:[(0,z.tZ)(q,{}),(0,z.tZ)(Ul,{}),(0,z.tZ)(Ql,{}),(0,z.tZ)(rr,{}),(0,z.tZ)(_.J,{}),(0,z.tZ)(sr,{})]}),!!t&&(0,z.tZ)(C.Z,{onClick:t})]}),(0,z.BX)(d.Z,{display:"flex",gap:1,flexWrap:"wrap",children:[l&&(0,z.tZ)(B.Z,{level:l.level,ascension:l.ascension,setBoth:m}),(0,z.tZ)(w.Hn,{size:"small"}),(0,z.tZ)(w.pg,{}),(0,z.tZ)(w.oX,{size:"small"})]}),(0,z.tZ)(v.Z,{children:(0,z.tZ)(lr,{tab:h})}),(0,z.tZ)(ir,{}),(0,z.tZ)(v.Z,{children:(0,z.tZ)(lr,{tab:h})})]})})})})}):(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:1e3})})}function ir(){return(0,z.tZ)(f.Suspense,{fallback:(0,z.tZ)(u.Z,{variant:"rectangular",width:"100%",height:500}),children:(0,z.BX)(x.Z5,{children:[(0,z.tZ)(x.AW,{index:!0,element:(0,z.tZ)(cl,{})}),(0,z.tZ)(x.AW,{path:"/talent",element:(0,z.tZ)(Zl,{})}),(0,z.tZ)(x.AW,{path:"/teambuffs",element:(0,z.tZ)(vl,{})}),(0,z.tZ)(x.AW,{path:"/optimize",element:(0,z.tZ)(mi,{})}),(0,z.tZ)(x.AW,{path:"/theorycraft",element:(0,z.tZ)(Vl,{})})]})})}function lr({tab:e}){const{t}=(0,g.$G)("page_character");return(0,z.BX)(h.Z,{value:e,variant:"scrollable",allowScrollButtonsMobile:!0,sx:{"& .MuiTab-root:hover":{transition:"background-color 0.25s ease",backgroundColor:"rgba(255,255,255,0.1)"}},children:[(0,z.tZ)(p.Z,{sx:{minWidth:"20%"},value:"overview",label:t("tabs.overview"),icon:(0,z.tZ)(a.Z,{}),component:y.rU,to:""}),(0,z.tZ)(p.Z,{sx:{minWidth:"20%"},value:"talent",label:t("tabs.talent"),icon:(0,z.tZ)(i.Z,{}),component:y.rU,to:"talent"}),(0,z.tZ)(p.Z,{sx:{minWidth:"20%"},value:"teambuffs",label:t("tabs.teambuffs"),icon:(0,z.tZ)(l.Z,{}),component:y.rU,to:"teambuffs"}),(0,z.tZ)(p.Z,{sx:{minWidth:"20%"},value:"optimize",label:t("tabs.optimize"),icon:(0,z.tZ)(r.Z,{}),component:y.rU,to:"optimize"}),(0,z.tZ)(p.Z,{sx:{minWidth:"20%"},value:"theorycraft",label:t("tabs.theorycraft"),icon:(0,z.tZ)(s.Z,{}),component:y.rU,to:"theorycraft"})]})}function rr(){const{t:e}=(0,g.$G)("page_character"),[t,n,a]=(0,j.Z)(),{character:{bonusStats:i}}=(0,f.useContext)(S.K),l=Object.keys(i).length;return(0,z.BX)(z.HY,{children:[(0,z.BX)(m.Z,{color:"info",startIcon:(0,z.tZ)(c.Z,{}),onClick:n,children:[e(er||(er=tr`addStats.title`)),!!l&&(0,z.tZ)(k.Z,{sx:{ml:1},color:"success",children:l})]}),(0,z.tZ)(Ne,{open:t,onClose:a})]})}function sr(){const{onModalOpen:e}=(0,f.useContext)(P.M);return(0,z.BX)(z.HY,{children:[(0,z.BX)(m.Z,{color:"info",startIcon:(0,z.tZ)(o.Z,{}),onClick:e,children:["Formulas ","&"," Calcs"]}),(0,z.tZ)(re,{})]})}}}]);